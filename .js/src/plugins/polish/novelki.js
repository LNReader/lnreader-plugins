var e=this&&this.__awaiter||function(e,t,a,l){return new(a||(a=Promise))((function(n,r){function i(e){try{u(l.next(e))}catch(e){r(e)}}function o(e){try{u(l.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,o)}u((l=l.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,l,n,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(u){return function(o){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(r=0)),r;)try{if(a=1,l&&(n=2&o[0]?l.return:o[0]?l.throw||((n=l.return)&&n.call(l),0):l.next)&&!(n=n.call(l,o[1])).done)return n;switch(l=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,l=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(n=r.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){r.label=o[1];break}if(6===o[0]&&r.label<n[1]){r.label=n[1],n=o;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(o);break}n[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],l=0}finally{a=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("@libs/fetch"),l=require("@libs/filterInputs"),n=require("cheerio"),r=require("@libs/novelStatus"),i=function(){function i(){this.id="novelki.pl",this.name="Novelki",this.icon="src/pl/novelki/icon.png",this.site="https://novelki.pl",this.version="1.0.3",this.filters={genres:{value:"",label:"Genre",options:[{label:"Wybierz gatunek",value:""},{label:"Adaptacja do anime",value:"35"},{label:"Adaptacja do dramy",value:"40"},{label:"Adaptacja do mangi",value:"36"},{label:"Akcja",value:"1"},{label:"Boys Love",value:"22"},{label:"Bromans",value:"33"},{label:"Dojrzały",value:"11"},{label:"Dramat",value:"10"},{label:"Ecchi",value:"29"},{label:"Fantasy",value:"2"},{label:"Gender Bender",value:"28"},{label:"Girls Love",value:"23"},{label:"Harem",value:"8"},{label:"Hentai",value:"43"},{label:"Historyczny",value:"30"},{label:"Horror",value:"15"},{label:"Isekai",value:"44"},{label:"Josei",value:"27"},{label:"Komedia",value:"3"},{label:"Mecha",value:"16"},{label:"Nadprzyrodzone",value:"9"},{label:"Okruchy życia",value:"18"},{label:"Oneshot",value:"41"},{label:"Parodia",value:"19"},{label:"Przygodowy",value:"4"},{label:"Psychologiczny",value:"12"},{label:"Reinkarnacja",value:"42"},{label:"Romans",value:"7"},{label:"RPG",value:"17"},{label:"Sci-fi",value:"21"},{label:"Seinen",value:"26"},{label:"Shoujo",value:"25"},{label:"Shounen",value:"24"},{label:"Smut",value:"31"},{label:"Sport",value:"32"},{label:"Świat gry",value:"5"},{label:"Szkolne życie",value:"20"},{label:"Sztuki walki",value:"6"},{label:"Tajemnica",value:"14"},{label:"Tragedia",value:"13"}],type:l.FilterTypes.Picker},status:{label:"Status",value:"",options:[{label:"Wybierz status",value:""},{label:"Zakończony",value:"0"},{label:"Aktywny",value:"1"},{label:"Porzucony",value:"2"},{label:"Wstrzymany",value:"3"},{label:"Zlicencjonowany",value:"4"}],type:l.FilterTypes.Picker},type:{label:"Type",value:"",options:[{label:"Wybierz typ",value:""},{label:"Nie zdefiniowano",value:"0"},{label:"Light Novel",value:"1"},{label:"Wuxia",value:"2"},{label:"Xianxia",value:"3"},{label:"Web Novel",value:"4"},{label:"Autorska",value:"5"},{label:"Inne",value:"6"}],type:l.FilterTypes.Picker}}}return i.prototype.popularNovels=function(l,r){return e(this,arguments,void 0,(function(e,l){var r,i,o,u,s=this,c=l.filters;return t(this,(function(t){switch(t.label){case 0:return r=this.site+"/projekty?filter=t",r+="&genre="+(null==c?void 0:c.genres.value),r+="&status="+(null==c?void 0:c.status.value),r+="&type="+(null==c?void 0:c.type.value),r+="&page="+e,[4,(0,a.fetchApi)(r).then((function(e){if(e.url=="".concat(s.site,"/guest"))throw new Error("Failed to load novels (open in web view and login)");return e.text()}))];case 1:return i=t.sent(),o=(0,n.load)(i),u=o("#projects > div"),[2,u.map((function(e,t){return{name:o(t).find(".card-title").attr("title"),cover:s.site+o(t).find(".card-img-top").attr("src"),path:o(t).find("a").attr("href")||""}})).get().filter((function(e){return e.name&&e.path}))]}}))}))},i.prototype.parseNovel=function(l){return e(this,void 0,void 0,(function(){var e,i,o,u,s;return t(this,(function(t){switch(t.label){case 0:return[4,(0,a.fetchApi)(this.site+l).then((function(e){return e.text()}))];case 1:return e=t.sent(),i=(0,n.load)(e),o={path:l,name:""},i("p.h5").each((function(e,t){var a=i(t).text().trim();if(a.includes("Autor:")&&(o.author=a.split(":")[1].trim()),a.includes("Status projektu:"))switch("".concat(a.split(":")[1].trim()).toLowerCase()){case"wstrzymany":o.status=r.NovelStatus.OnHiatus;break;case"zakończony":o.status=r.NovelStatus.Completed;break;case"aktywny":o.status=r.NovelStatus.Ongoing;break;case"porzucony":o.status=r.NovelStatus.Cancelled;break;case"zlicencjonowany":o.status=r.NovelStatus.Licensed;break;default:o.status=r.NovelStatus.Unknown}})),o.name=i("div.col-sm-12.col-md-6.col-lg-8.mb-5").find("h3").text().trim(),o.cover=this.site+i(".img-fluid").attr("src"),o.genres=i("span.badge").map((function(e,t){return i(t).text()})).get().join(", "),o.summary=i('.h5:contains("Opis:")').next("p").next("p").text().trim(),u=[],(s=i(".chapters > .col-md-3 > div").get()).forEach((function(e,t){var a,l=i(e).find("a").attr("href")||"",n={name:null===(a=i(e).find("a"))||void 0===a?void 0:a.text().trim(),path:l,releaseTime:i(e).find(".card-footer > span").text().trim().split("-").reverse().join("-"),chapterNumber:s.length-t};u.push(n)})),o.chapters=u.reverse(),[2,o]}}))}))},i.prototype.parseChapter=function(l){return e(this,void 0,void 0,(function(){var e,n,r=this;return t(this,(function(t){switch(t.label){case 0:return e=/\/projekty\/([^/]+)\/([^/]+)/.exec(l)||"",[4,(0,a.fetchApi)("".concat(this.site,"/api/reader/chapters/").concat(e[2])).then((function(e){if(e.url=="".concat(r.site,"/guest"))throw new Error("Failed to load chapter (open in web view and login)");return e.json()}))];case 1:return n=t.sent(),[2,n.data.content]}}))}))},i.prototype.searchNovels=function(l,r){return e(this,void 0,void 0,(function(){var e,i,o=this;return t(this,(function(t){switch(t.label){case 0:return[4,(0,a.fetchApi)("".concat(this.site,"/projekty?filter=t&title=").concat(l,"+&page=").concat(r)).then((function(e){if(e.url=="".concat(o.site,"/guest"))throw new Error("Failed to search novels (open in web view and login)");return e.text()}))];case 1:return e=t.sent(),i=(0,n.load)(e),[2,i("#projects > div").map((function(e,t){return{name:i(t).find(".card-title").attr("title"),cover:o.site+i(t).find(".card-img-top").attr("src"),path:i(t).find("a").attr("href")||""}})).get().filter((function(e){return e.name&&e.path}))]}}))}))},i}();exports.default=new i;