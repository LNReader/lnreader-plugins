var t=this&&this.__awaiter||function(t,e,r,a){return new(r||(r=Promise))((function(n,o){function i(t){try{c(a.next(t))}catch(t){o(t)}}function l(t){try{c(a.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,l)}c((a=a.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,a,n,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=l(0),i.throw=l(1),i.return=l(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(c){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(o=0)),o;)try{if(r=1,a&&(n=2&l[0]?a.return:l[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,l[1])).done)return n;switch(a=0,n&&(l=[2&l[0],n.value]),l[0]){case 0:case 1:n=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,a=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==l[0]&&2!==l[0])){o=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3])){o.label=l[1];break}if(6===l[0]&&o.label<n[1]){o.label=n[1],n=l;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(l);break}n[2]&&o.ops.pop(),o.trys.pop();continue}l=e.call(t,o)}catch(t){l=[6,t],a=0}finally{r=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("cheerio"),a=require("@libs/fetch"),n=require("@libs/filterInputs"),o=require("@libs/novelStatus"),i=function(){function i(){this.id="linovelib",this.name="Linovelib",this.icon="src/cn/linovelib/icon.png",this.site="https://www.bilinovel.com",this.version="1.1.3",this.filters={rank:{label:"排行榜",value:"monthvisit",options:[{label:"月点击榜",value:"monthvisit"},{label:"周点击榜",value:"weekvisit"},{label:"月推荐榜",value:"monthvote"},{label:"周推荐榜",value:"weekvote"},{label:"月鲜花榜",value:"monthflower"},{label:"周鲜花榜",value:"weekflower"},{label:"月鸡蛋榜",value:"monthegg"},{label:"周鸡蛋榜",value:"weekegg"},{label:"最近更新",value:"lastupdate"},{label:"最新入库",value:"postdate"},{label:"收藏榜",value:"goodnum"},{label:"新书榜",value:"newhot"}],type:n.FilterTypes.Picker}}}return i.prototype.popularNovels=function(n,o){return t(this,arguments,void 0,(function(t,n){var o,i,l,c,s,u=n.showLatestNovels,h=n.filters;return e(this,(function(e){switch(e.label){case 0:return o=u?"lastupdate":h.rank.value,i="".concat(this.site,"/top/").concat(o,"/").concat(t,".html"),[4,(0,a.fetchText)(i)];case 1:if(""===(l=e.sent()))throw Error("无法获取小说列表，请检查网络");return c=(0,r.load)(l),s=[],c(".module-rank-booklist .book-layout").each((function(t,e){var r=c(e).attr("href"),a=c(e).find(".book-title").text(),n=c(e).find("div.book-cover > img").attr("data-src");if(r){var o={name:a,cover:n,path:r};s.push(o)}})),[2,s]}}))}))},i.prototype.parseNovel=function(n){return t(this,void 0,void 0,(function(){var t,i,l,c,s,u,h,f,v,p,b,d,m,g;return e(this,(function(e){switch(e.label){case 0:return t=this.site+n,[4,(0,a.fetchText)(t)];case 1:if(""===(i=e.sent()))throw Error("无法获取小说内容，请检查网络");return l=(0,r.load)(i),(c={path:n,chapters:[],name:l("#bookDetailWrapper .book-title").text()}).cover=l("#bookDetailWrapper img.book-cover").attr("src"),c.summary=l("#bookSummary content").text(),c.author=l("#bookDetailWrapper .book-rand-a a").text(),s=l("#bookDetailWrapper .book-meta").text(),c.status=s.includes("完结")?o.NovelStatus.Completed:o.NovelStatus.Ongoing,c.genres=l(".tag-small.red").children("a").map((function(t,e){return l(e).text()})).toArray().join(","),u=[],h=/\/(\d+)\.html/,f=null===(g=t.match(h))||void 0===g?void 0:g[1],v=this.site+l("#btnReadBook").attr("href"),[4,(0,a.fetchText)(v)];case 2:return p=e.sent(),(b=(0,r.load)(p))("#volumes .chapter-li:not(.volume-cover)").each((function(t,e){if(b(e).hasClass("chapter-bar"))d=b(e).text();else{var r=b(e).find(".chapter-li-a").attr("href"),a=null==r?void 0:r.match(h);a?m=+a[1]:m++;var n="/novel/".concat(f,"/").concat(m,".html"),o=d+" — "+b(e).find(".chapter-index").text().trim();m&&u.push({name:o,releaseTime:null,path:n})}})),c.chapters=u,[2,c]}}))}))},i.prototype.parseChapter=function(n){return t(this,void 0,void 0,(function(){var o,i,l,c,s,u,h,f,v,p,b,d,m=this;return e(this,(function(g){switch(g.label){case 0:i="",s="",u=1,h={"“":"「","”":"」","‘":"『","’":"』","":"的","":"一","":"是","":"了","":"我","":"不","":"人","":"在","":"他","":"有","":"这","":"个","":"上","":"们","":"来","":"到","":"时","":"大","":"地","":"为","":"子","":"中","":"你","":"说","":"生","":"国","":"年","":"着","":"就","":"那","":"和","":"要","":"她","":"出","":"也","":"得","":"里","":"后","":"自","":"以","":"会","":"家","":"可","":"下","":"而","":"过","":"天","":"去","":"能","":"对","":"小","":"多","":"然","":"于","":"心","":"学","":"么","":"之","":"都","":"好","":"看","":"起","":"发","":"当","":"没","":"成","":"只","":"如","":"事","":"把","":"还","":"用","":"第","":"样","":"道","":"想","":"作","":"种","":"开","":"美","":"乳","":"阴","":"液","":"茎","":"欲","":"呻","":"肉","":"交","":"性","":"胸","":"私","":"穴","":"淫","":"臀","":"舔","":"射","":"脱","":"裸","":"骚","":"唇"},f=function(r){return t(m,void 0,void 0,(function(){var a=this;return e(this,(function(n){switch(n.label){case 0:return[4,function(){return t(a,void 0,void 0,(function(){return e(this,(function(t){return r("#acontent .adsbygoogle, #acontent script, center").remove(),r("#acontent img.imagecontent").each((function(t,e){var a=r(e).attr("data-src")||r(e).attr("src");a&&r(e).attr("src",a).removeAttr("data-src").removeClass("lazyload")})),s=(s=r("#acontent").html()||"").replace(/./g,(function(t){return h[t]||t})),[2,Promise.resolve()]}))}))}()];case 1:return n.sent(),o=r("#atitle + h3").text()+" — "+r("#atitle").text(),""===i&&(i="<h2>"+o+"</h2>"),i+=s,[2]}}))}))},v=function(n){return t(m,void 0,void 0,(function(){var t,o,i;return e(this,(function(e){switch(e.label){case 0:return t={Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Language":"zh-CN,zh;q=0.9,zh-TW;q=0.8,zh-HK;q=0.7,en;q=0.6,en-GB;q=0.5,en-US;q=0.4","Cache-Control":"no-cache"},[4,(0,a.fetchText)(n,{headers:t})];case 1:return o=e.sent(),i=(0,r.load)(o),[4,f(i)];case 2:return e.sent(),c="下一页"===i("#footlink a:last").text()||"下一頁"===i("#footlink a:last").text(),[2,{pageCheerio:i,pageHasNextPage:c}]}}))}))},p=this.site+n,b=p,g.label=1;case 1:return[4,v(p)];case 2:d=g.sent(),!0===(l=d.pageHasNextPage)&&(u++,p=b.replace(/\.html/gi,"_".concat(u)+".html")),g.label=3;case 3:if(!0===l)return[3,1];g.label=4;case 4:return[2,i]}}))}))},i.prototype.searchNovels=function(n,o){return t(this,void 0,void 0,(function(){var t,i,l,c;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site,"/search/").concat(encodeURI(n),"_").concat(o,".html"),[4,(0,a.fetchText)(t)];case 1:if(""===(i=e.sent()))throw Error("无法获取搜索结果，请检查网络");return l=(0,r.load)(i),c=[],l(".book-ol .book-layout").each((function(t,e){var r=l(e).attr("href"),a=l(e).find(".book-title").text(),n=l(e).find("div.book-cover > img").attr("data-src");r&&c.push({name:a,path:r,cover:n})})),[2,c]}}))}))},i}();exports.default=new i;