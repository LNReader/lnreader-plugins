var t=this&&this.__assign||function(){return t=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},t.apply(this,arguments)},e=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{l(r.next(t))}catch(t){i(t)}}function s(t){try{l(r.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}l((r=r.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("cheerio"),a=require("@libs/fetch"),i=require("@libs/filterInputs"),o=require("@libs/novelStatus"),s=function(){function s(){this.fetchOptions={headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:137.0) Gecko/20100101 Firefox/137.0",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8","Accept-Language":"en-US,us;q=0.5",Referer:"https://www.69shu.xyz/",DNT:"1","Upgrade-Insecure-Requests":"1"}},this.id="69shu",this.name="69书吧",this.icon="src/cn/69shu/icon.png",this.site="https://www.69shu.xyz",this.version="0.2.2",this.filters={rank:{label:"排行榜",value:"allvisit",options:[{label:"总排行榜",value:"allvisit"},{label:"月排行榜",value:"monthvisit"},{label:"周排行榜",value:"weekvisit"},{label:"日排行榜",value:"dayvisit"},{label:"收藏榜",value:"goodnum"},{label:"字数榜",value:"words"},{label:"推荐榜",value:"allvote"},{label:"新书榜",value:"postdate"},{label:"更新榜",value:"lastupdate"}],type:i.FilterTypes.Picker},sort:{label:"分类",value:"none",options:[{label:"无",value:"none"},{label:"全部",value:"all"},{label:"玄幻",value:"xuanhuan"},{label:"仙侠",value:"xianxia"},{label:"都市",value:"dushi"},{label:"历史",value:"lishi"},{label:"游戏",value:"youxi"},{label:"科幻",value:"kehuan"},{label:"灵异",value:"kongbu"},{label:"言情",value:"nvsheng"},{label:"其它",value:"qita"}],type:i.FilterTypes.Picker}}}return s.prototype.popularNovels=function(t,i){return e(this,arguments,void 0,(function(t,e){var i,o,s,l,c=this,u=e.showLatestNovels,h=e.filters;return n(this,(function(e){switch(e.label){case 0:return i=u?"".concat(this.site,"/rank/lastupdate/").concat(t,".html"):"none"===h.sort.value?"".concat(this.site,"/rank/").concat(h.rank.value,"/").concat(t,".html"):"".concat(this.site,"/sort/").concat(h.sort.value,"/").concat(t,".html"),[4,(0,a.fetchText)(i,this.fetchOptions)];case 1:if(""===(o=e.sent()))throw Error("无法获取小说列表，请检查网络");return s=(0,r.load)(o),l=[],s("div.book-coverlist").each((function(t,e){var n=s(e).find("a.cover").attr("href"),r=s(e).find("h4.name").text().trim(),a=s(e).find("a.cover > img").attr("src");if(n){var i={name:r,cover:a,path:n.replace(c.site,"")};l.push(i)}})),[2,l]}}))}))},s.prototype.parseNovel=function(t){return e(this,void 0,void 0,(function(){var e,i,s,l,c,u,h,f,p,v,d,b,m=this;return n(this,(function(w){switch(w.label){case 0:return e=this.site+t,[4,(0,a.fetchText)(e,this.fetchOptions)];case 1:if(""===(i=w.sent()))throw Error("无法获取小说内容，请检查网络");if(s=(0,r.load)(i),(l={path:t,chapters:[],name:s("h1").text().trim()}).cover=s("div.cover > img").attr("src"),l.summary=s("#bookIntro").text().trim(),c=s("div.caption-bookinfo > p"),l.author=c.find("a").attr("title"),l.artist=void 0,l.status=c.text().includes("连载")?o.NovelStatus.Ongoing:o.NovelStatus.Completed,l.genres="",u=[],!(h=s("dd.all > a").attr("href")))return[3,5];f=new URL(h,this.site).toString(),p=!0,v=function(){var t,e,i,o,s;return n(this,(function(n){switch(n.label){case 0:return[4,(0,a.fetchText)(f,d.fetchOptions)];case 1:if(t=n.sent(),(e=(0,r.load)(t))("dl.panel-chapterlist dd").each((function(t,n){var r=e(n).find("a").attr("href"),a=e(n).find("a").text().trim();if(r){var i=r.startsWith("http")?r.replace(m.site,""):r;u.some((function(t){return t.path===i}))||u.push({name:a,path:i})}})),i=e("div.listpage a.onclick").filter((function(t,n){return e(n).text().includes("下一页")})),(o=i.attr("href"))&&"javascript:void(0);"!==o)try{(s=new URL(o,d.site).toString())===f?p=!1:f=s}catch(t){console.warn("Invalid next page link found: ".concat(o)),p=!1}else p=!1;return[2]}}))},d=this,w.label=2;case 2:return p?[5,v()]:[3,4];case 3:return w.sent(),[3,2];case 4:return[3,6];case 5:s("div.panel.hidden-xs > dl.panel-chapterlist:nth-child(2) > dd").each((function(t,e){var n=s(e).find("a").attr("href"),r=s(e).find("a").text().trim();if(n){var a=n.startsWith("http")?n.replace(m.site,""):n;u.push({name:r,path:a})}})),w.label=6;case 6:return b=u.filter((function(t,e,n){return e===n.findIndex((function(e){return e.path===t.path}))})),l.chapters=b,[2,l]}}))}))},s.prototype.parseChapter=function(t){return e(this,void 0,void 0,(function(){var e,i,o;return n(this,(function(n){switch(n.label){case 0:return e=new URL(t,this.site).toString(),[4,(0,a.fetchText)(e,this.fetchOptions)];case 1:return i=n.sent(),o=(0,r.load)(i),[2,o("#chaptercontent p").map((function(t,e){return o(e).text()})).get().map((function(t){return t.trim()})).filter((function(t){return""!==t&&!t.includes("69书吧")})).map((function(t){return"<p>".concat(t,"</p>")})).join("\n")]}}))}))},s.prototype.searchNovels=function(i,o){return e(this,void 0,void 0,(function(){var e,s,l,c,u,h,f=this;return n(this,(function(n){switch(n.label){case 0:return o>1?[2,[]]:(e="".concat(this.site,"/search"),(s=new FormData).append("searchkey",i),l=t(t({},this.fetchOptions),{method:"post",body:s,headers:t({},this.fetchOptions.headers)}),[4,(0,a.fetchText)(e,l)]);case 1:if(""===(c=n.sent()))throw Error("无法获取搜索结果，请检查网络");return u=(0,r.load)(c),h=[],u("div.book-coverlist").each((function(t,e){var n=u(e).find("a.cover").attr("href"),r=u(e).find("h4.name").text().trim(),a=u(e).find("a.cover > img").attr("src");if(n){var i={name:r,cover:a,path:n.replace(f.site,"")};h.push(i)}})),[2,h]}}))}))},s}();exports.default=new s;