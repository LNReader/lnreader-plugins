var e=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function l(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,s)}u((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,n,r,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=s(0),l.throw=s(1),l.return=s(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function s(s){return function(u){return function(s){if(a)throw new TypeError("Generator is already executing.");for(;l&&(l=0,s[0]&&(i=0)),i;)try{if(a=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{a=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("cheerio"),n=require("@libs/fetch"),r=require("@libs/novelStatus"),i=require("@libs/filterInputs"),l=function(){function l(){this.id="bakainua",this.name="BakaInUA",this.icon="src/uk/bakainua/icon.png",this.site="https://baka.in.ua",this.version="2.0.0",this.filters={genre:{type:i.FilterTypes.Picker,label:"Жанр",value:"",options:[{label:"Всі жанри",value:""},{label:"BL",value:"19"},{label:"GL",value:"20"},{label:"Авторське",value:"32"},{label:"Бойовик",value:"2"},{label:"Вуся",value:"16"},{label:"Гарем",value:"5"},{label:"Детектив",value:"22"},{label:"Драма",value:"12"},{label:"Жахи",value:"10"},{label:"Ісекай",value:"13"},{label:"Історичне",value:"15"},{label:"Комедія",value:"11"},{label:"ЛГБТ",value:"3"},{label:"Містика",value:"18"},{label:"Омегаверс",value:"30"},{label:"Повсякденність",value:"17"},{label:"Пригоди",value:"7"},{label:"Психологія",value:"28"},{label:"Романтика",value:"1"},{label:"Спорт",value:"9"},{label:"Сюаньхвань",value:"27"},{label:"Сянься",value:"26"},{label:"Трагедія",value:"24"},{label:"Трилер",value:"21"},{label:"Фантастика",value:"8"},{label:"Фанфік",value:"23"},{label:"Фентезі",value:"4"},{label:"Школа",value:"6"}]},only_new:{type:i.FilterTypes.Switch,label:"Новинки",value:!1},longreads:{type:i.FilterTypes.Switch,label:"Довгочити",value:!1},finished:{type:i.FilterTypes.Switch,label:"Завершене",value:!1}}}return l.prototype.popularNovels=function(r,i){return e(this,arguments,void 0,(function(r,i){var l,s,u,o,c,h=this,p=i.filters,v=i.showLatestNovels;return t(this,(function(i){switch(i.label){case 0:return l=[],s=new URL(this.site+"/fictions/alphabetical"),r>1&&s.searchParams.append("page",r.toString()),(v||p&&p.only_new.value)&&s.searchParams.append("only_new","1"),p&&(p.longreads.value&&s.searchParams.append("longreads","1"),p.finished.value&&s.searchParams.append("finished","1"),""!==p.genre.value&&s.searchParams.append("genre",p.genre.value)),[4,(0,n.fetchApi)(s.toString())];case 1:return[4,i.sent().text()];case 2:return u=i.sent(),(o=(0,a.load)(u))("div#fiction-list-page > div > div > div > img").each((function(e,t){var a=o(t).attr("data-fiction-picker-id-param");a&&l.push(a)})),c=l.map((function(r){return e(h,void 0,void 0,(function(){var e,i,l,s;return t(this,(function(t){switch(t.label){case 0:return[4,(0,n.fetchApi)("".concat(this.site,"/fictions/").concat(r,"/details"),{headers:{accept:"text/vnd.turbo-stream.html"}})];case 1:return e=t.sent(),l=a.load,[4,e.text()];case 2:return i=l.apply(void 0,[t.sent()]),s=i("a").first(),[2,{name:i("h3").text().trim(),path:s.attr("href")||"",cover:this.site+i(s).find("img").attr("src")}]}}))}))})),[4,Promise.all(c)];case 3:return[2,i.sent()]}}))}))},l.prototype.parseNovel=function(i){return e(this,void 0,void 0,(function(){var e,l,s,u;return t(this,(function(t){switch(t.label){case 0:return[4,(0,n.fetchApi)(this.site+"/"+i)];case 1:return[4,t.sent().text()];case 2:switch(e=t.sent(),l=(0,a.load)(e),s={path:i,name:l("main div > h1").text().trim(),author:l("button#fictions-author-search").text().trim(),cover:this.site+l("main div > img").attr("src"),summary:l("main div > h3").first().parent().find("div").text().trim(),genres:l('h4:contains("Жанри")').last().siblings().last().find("span").map((function(e,t){return l(t).text().trim()})).get().join(", ")},l('div:contains("Статус")').last().siblings().text().trim()){case"Видаєт.":s.status=r.NovelStatus.Ongoing;break;case"Заверш.":s.status=r.NovelStatus.Completed;break;case"Покину.":s.status=r.NovelStatus.OnHiatus;break;default:s.status=r.NovelStatus.Unknown}return u=[],l("li.group a").each((function(e,t){var a={name:l(t).find("span").eq(1).text().trim(),path:l(t).attr("href")||"",chapterNumber:parseInt(l(t).find("span").eq(0).text().trim()),releaseTime:l(t).find("span").eq(2).text().trim()};u.push(a)})),s.chapters=u.reverse(),[2,s]}}))}))},l.prototype.parseChapter=function(r){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,(0,n.fetchApi)(this.site+"/"+r)];case 1:return[4,t.sent().text()];case 2:return e=t.sent(),[2,(0,a.load)(e)("#user-content").html()||""]}}))}))},l.prototype.searchNovels=function(r){return e(this,void 0,void 0,(function(){var e,i,l,s=this;return t(this,(function(t){switch(t.label){case 0:return e=[],[4,(0,n.fetchApi)(this.site+"/search?search%5B%5D="+r+"&only_fictions=true")];case 1:return[4,t.sent().text()];case 2:return i=t.sent(),(l=(0,a.load)(i))("ul > section").each((function(t,a){e.push({path:l(a).find("a").first().attr("href")||"",name:l(a).find("a > h2").first().text().trim(),cover:s.site+l(a).find("img").first().attr("src")})})),[2,e]}}))}))},l}();exports.default=new l;