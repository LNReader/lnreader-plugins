var e=this&&this.__assign||function(){return e=Object.assign||function(e){for(var t,a=1,l=arguments.length;a<l;a++)for(var n in t=arguments[a])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},e.apply(this,arguments)},t=this&&this.__awaiter||function(e,t,a,l){return new(a||(a=Promise))((function(n,r){function i(e){try{u(l.next(e))}catch(e){r(e)}}function o(e){try{u(l.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,o)}u((l=l.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var a,l,n,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(u){return function(o){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(r=0)),r;)try{if(a=1,l&&(n=2&o[0]?l.return:o[0]?l.throw||((n=l.return)&&n.call(l),0):l.next)&&!(n=n.call(l,o[1])).done)return n;switch(l=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,l=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(n=r.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){r.label=o[1];break}if(6===o[0]&&r.label<n[1]){r.label=n[1],n=o;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(o);break}n[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],l=0}finally{a=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},l=this&&this.__spreadArray||function(e,t,a){if(a||2===arguments.length)for(var l,n=0,r=t.length;n<r;n++)!l&&n in t||(l||(l=Array.prototype.slice.call(t,0,n)),l[n]=t[n]);return e.concat(l||Array.prototype.slice.call(t))};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("cheerio"),r=require("@libs/fetch"),i=require("@libs/filterInputs"),o=function(){function o(){this.id="mangatr",this.name="MangaTR",this.icon="src/tr/mangatr/icon.png",this.site="https://manga-tr.com/",this.version="1.0.0",this.opts={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","x-requested-with":"XMLHttpRequest"}},this.filters={sort:{value:"views",label:"Sırala",options:[{label:"Adı",value:"name"},{label:"Popülarite",value:"views"},{label:"Son Güncelleme",value:"last_update"}],type:i.FilterTypes.Picker},sort_type:{value:"DESC",label:"Sırala Türü",options:[{label:"ASC",value:"ASC"},{label:"DESC",value:"DESC"}],type:i.FilterTypes.Picker},status:{value:"",label:"Durum",options:[{label:"Hepsi",value:""},{label:"Yayınlanması Tamamlanan",value:"1"},{label:"Devam Eden",value:"2"}],type:i.FilterTypes.Picker},translation:{value:"",label:"Çeviri Durumu",options:[{label:"Hepsi",value:""},{label:"Çevirisi Tamamlanan",value:"1"},{label:"Devam Eden",value:"4"},{label:"Bırakılan",value:"2"},{label:"Olmayan",value:"3"}],type:i.FilterTypes.Picker},age:{value:"",label:"Yas",options:[{label:"Hepsi",value:""},{label:"+16",value:"16"},{label:"+18",value:"18"}],type:i.FilterTypes.Picker},genre:{value:"",label:"Tür",options:[{label:"Hepsi",value:""},{label:"4 Koma",value:"4_Koma"},{label:"Action",value:"Action"},{label:"Adventure",value:"Adventure"},{label:"Aliens",value:"Aliens"},{label:"Art",value:"Art"},{label:"Biography",value:"Biography"},{label:"Bishoujo",value:"Bishoujo"},{label:"Bishounen",value:"Bishounen"},{label:"Comedy",value:"Comedy"},{label:"Crime",value:"Crime"},{label:"Demons",value:"Demons"},{label:"Doujinshi",value:"Doujinshi"},{label:"Drama",value:"Drama"},{label:"Ecchi",value:"Ecchi"},{label:"Fantasy",value:"Fantasy"},{label:"Gore",value:"Gore"},{label:"Harem",value:"Harem"},{label:"History",value:"History"},{label:"Horror",value:"Horror"},{label:"Isekai",value:"Isekai"},{label:"Josei",value:"Josei"},{label:"Magic",value:"Magic"},{label:"Manhua",value:"Manhua"},{label:"Manhwa",value:"Manhwa"},{label:"Martial",value:"Martial"},{label:"Mecha",value:"Mecha"},{label:"Military",value:"Military"},{label:"Miscellaneous",value:"Miscellaneous"},{label:"Monster",value:"Monster"},{label:"Musical",value:"Musical"},{label:"Mystery",value:"Mystery"},{label:"Novel",value:"Novel"},{label:"Nudity",value:"Nudity"},{label:"One Shot",value:"One_Shot"},{label:"Romance",value:"Romance"},{label:"Psychological",value:"Psychological"},{label:"Seinen",value:"Seinen"},{label:"School",value:"School"},{label:"Sci fi",value:"Sci_fi"},{label:"Short",value:"Short"},{label:"Shoujo",value:"Shoujo"},{label:"Shoujo Ai",value:"Shoujo_Ai"},{label:"Shounen",value:"Shounen"},{label:"Shounen Ai",value:"Shounen_Ai"},{label:"Slice of life",value:"Slice of life"},{label:"Supernatural",value:"Supernatural"},{label:"Space",value:"Space"},{label:"Sports",value:"Sports"},{label:"Thriller",value:"Thriller"},{label:"Tragedy",value:"Tragedy"},{label:"Türkçe Novel",value:"Türkçe Novel"},{label:"Vampires",value:"Vampires"},{label:"Violence",value:"Violence"},{label:"War",value:"War"},{label:"Webtoon",value:"Webtoon"},{label:"Western",value:"Western"}],type:i.FilterTypes.Picker}}}return o.prototype.parseNovel=function(i){return t(this,void 0,void 0,(function(){var t,o,u,s,c,h,p,v,b,d,f,y,m,g,S,w,x,A,_=this;return a(this,(function(a){switch(a.label){case 0:return[4,(0,r.fetchApi)(this.site+i).then((function(e){return e.text()}))];case 1:return t=a.sent(),o=(0,n.load)(t),u={path:i,name:o("#tables").text(),cover:o("#myCarousel > div.container > div.col-lg-4.col-sm-4 > img").attr("src"),status:o("#tab1 > table:nth-child(2) > tbody > tr:nth-child(2) > td:nth-last-child(2) > a").text(),chapters:[],author:o("#tab1 > table:nth-child(3) > tbody > tr:nth-child(2) > td:nth-child(1) > a").map((function(e,t){return o(t).text()})).get().join(","),artist:o("#tab1 > table:nth-child(3) > tbody > tr:nth-child(2) > td:nth-child(2) > a").map((function(e,t){return o(t).text()})).get().join(","),genres:o("#tab1 > table:nth-child(3) > tbody > tr:nth-child(2) > td:nth-child(3) > a").map((function(e,t){return o(t).text()})).get().join(",")},(s=o("#tab1 > div.well")).children().remove("h3, div"),u.summary=s.text().trim(),c=[],h=i.split(".html")[0].slice(6),p="".concat(this.site,"cek/fetch_pages_manga.php?manga_cek=").concat(h),[4,(0,r.fetchApi)(p,e(e({},this.opts),{body:"page=1"}))];case 2:return v=a.sent(),d=n.load,[4,v.text()];case 3:return b=d.apply(void 0,[a.sent()]),f=parseInt(null!==(A=b('a[title="Last"]').first().attr("data-page"))&&void 0!==A?A:"1"),[4,Promise.all(Array.from({length:f-1},(function(t,a){return(0,r.fetchApi)(p,e(e({},_.opts),{body:"page=".concat(1+a+1)})).then((function(e){return e.text()}))}))).then((function(e){return e.map((function(e){return(0,n.load)(e)}))}))];case 4:for(y=a.sent(),y=l([b],y,!0),m=u.name.toLocaleLowerCase().replace(/\([0-9]+\)/g,"").trim(),g=function(e){e("body > ul > table > tbody > tr").each((function(t,a){var l,n=e(a),r=n.find("td:nth-child(1) > a").text(),i=r.toLocaleLowerCase().replace(m,"Ch").trim(),o=n.find("td:nth-child(1) > div").text(),u=null!==(l=n.find("td:nth-child(1) > a").attr("href"))&&void 0!==l?l:"";""!==u&&c.push({name:""!==o?"".concat(i,": ").concat(o):i,path:u,chapterNumber:parseFloat(r.replace(/[^0-9.]/g,""))})}))},S=0,w=y;S<w.length;S++)x=w[S],g(x);return c.length>0&&(u.chapters=c.reverse()),[2,u]}}))}))},o.prototype.popularNovels=function(e,t){var a=t.showLatestNovels,l=t.filters,i=new URLSearchParams;i.append("page",e.toString()),1==a?(i.append("sort","last_update"),i.append("sort_type","DESC")):(i.append("durum",l.status.value.toString()),i.append("ceviri",""),i.append("yas",l.age.value.toString()),i.append("icerik","2"),i.append("tur",l.genre.value.toString()),i.append("sort",l.sort.value.toString()),i.append("sort_type",l.sort_type.value.toString()));var o="".concat(this.site,"manga-list-sayfala.html?").concat(i.toString());return(0,r.fetchApi)(o).then((function(e){return e.text()})).then((function(e){return function(e){return e("#myCarousel > div.container > div:nth-child(3) > div.col-lg-9.col-md-8 > div.col-md-12").map((function(t,a){var l,n,r=e(a);return{name:r.find("#tables").text(),path:null!==(l=r.find("#tables > a").attr("href"))&&void 0!==l?l:"",cover:null!==(n=r.find("img.img-thumb").first().attr("src"))&&void 0!==n?n:""}})).toArray()}((0,n.load)(e))}))},o.prototype.parseChapter=function(e){return t(this,void 0,void 0,(function(){var t,l,i,o;return a(this,(function(a){switch(a.label){case 0:return[4,(0,r.fetchApi)(this.site+e).then((function(e){return e.text()}))];case 1:return t=a.sent(),l=(0,n.load)(t),i=l("#well"),[2,null!==(o=i.html())&&void 0!==o?o:""]}}))}))},o.prototype.searchNovels=function(l,i){return t(this,void 0,void 0,(function(){var o,u,s,c=this;return a(this,(function(h){return(o=new URLSearchParams).append("icerik",l),u="".concat(this.site,"arama.html?").concat(o.toString()),s=function(l){return t(c,void 0,void 0,(function(){var o,u,s,c,h,p,v,b,d,f=this;return a(this,(function(y){switch(y.label){case 0:for(o=[],u=0,s=0,c=l("div.char > a + span").toArray();s<c.length&&(h=c[s],50!==o.length);s++)"novel"!=l(h).text().trim().toLowerCase()&&"novel"!=l(h).next().text().trim().toLowerCase()||(50*(i-1)>u?u++:(p=l(h).prev(),v=null!==(b=p.attr("manga-slug"))&&void 0!==b?b:"",o.push({name:p.text(),path:null!==(d=p.attr("href"))&&void 0!==d?d:"",cover:v})));return[4,Promise.all(o.map((function(l){return t(f,void 0,void 0,(function(){var t,i,o,u;return a(this,(function(a){switch(a.label){case 0:return t="".concat(this.site,"app/manga/controllers/cont.pop.php"),[4,(0,r.fetchApi)(t,e(e({},this.opts),{body:"slug=".concat(l.cover)}))];case 1:return[4,a.sent().text()];case 2:return i=a.sent(),o=(0,n.load)(i),u=o("img").first().attr("src"),l.cover=u,[2,l]}}))}))})))];case 1:return[2,y.sent()]}}))}))},[2,(0,r.fetchApi)(u).then((function(e){return e.text()})).then((function(e){var t=(0,n.load)(e);return s(t)}))]}))}))},o.prototype.resolveUrl=function(e,t){return this.site+e},o}();exports.default=new o;