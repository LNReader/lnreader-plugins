var e=this&&this.__awaiter||function(e,t,a,r){return new(a||(a=Promise))((function(n,i){function l(e){try{u(r.next(e))}catch(e){i(e)}}function o(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(l,o)}u((r=r.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,r,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=o(0),l.throw=o(1),l.return=o(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function o(o){return function(u){return function(o){if(a)throw new TypeError("Generator is already executing.");for(;l&&(l=0,o[0]&&(i=0)),i;)try{if(a=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){i.label=o[1];break}if(6===o[0]&&i.label<n[1]){i.label=n[1],n=o;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(o);break}n[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{a=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("cheerio"),n=require("@libs/fetch"),i=require("@libs/novelStatus"),l=require("@libs/filterInputs"),o=require("@libs/defaultCover"),u=a(require("dayjs")),s=function(){function a(){this.id="noveldeglace",this.name="NovelDeGlace",this.icon="src/fr/noveldeglace/icon.png",this.site="https://noveldeglace.com/",this.version="1.0.3",this.filters={categorie_genre:{type:l.FilterTypes.Picker,label:"Catégorie/Genre",value:"all",options:[{label:"Tous",value:"all"},{label:"═══CATÉGORIES═══",value:"categorie_roman"},{label:"Seinen",value:"c_seinen"},{label:"Shonen",value:"c_shonen"},{label:"Original",value:"c_original"},{label:"Yuri",value:"c_yuri"},{label:"Autre",value:"c_autre"},{label:"Fille",value:"c_fille"},{label:"Roman pour Adulte",value:"c_roman-pour-adulte"},{label:"Xuanhuan",value:"c_xuanhuan"},{label:"Yaoi",value:"c_yaoi"},{label:"═══GENRES═══",value:"genre"},{label:"Action",value:"g_action"},{label:"Aventure",value:"g_aventure"},{label:"Comédie",value:"g_comedie"},{label:"Drame",value:"g_drame"},{label:"Fantastique",value:"g_fantastique"},{label:"Harem",value:"g_harem"},{label:"Psychologique",value:"g_psychologique"},{label:"Romance",value:"g_romance"},{label:"Ecchi",value:"g_ecchi"},{label:"Mature",value:"g_mature"},{label:"Surnaturel",value:"g_surnaturel"},{label:"Vie scolaire",value:"g_vie-scolaire"},{label:"Adulte",value:"g_adulte"},{label:"Tragédie",value:"g_tragedie"},{label:"Arts Martiaux",value:"g_arts-martiaux"},{label:"Pas de harem",value:"g_pas-de-harem"},{label:"Tranche de vie",value:"g_tranche-de-vie"},{label:"Mecha",value:"g_mecha"},{label:"Sci-fi",value:"g_sci-fi"},{label:"Science-Fiction",value:"g_science-fiction"},{label:"Anti-Héros",value:"g_anti-heros"},{label:"Horreur",value:"g_horreur"},{label:"Insectes",value:"g_insectes"},{label:"Mystère",value:"g_mystere"},{label:"Lolicon",value:"g_lolicon"},{label:"Shoujo Ai",value:"g_shoujo-ai"},{label:"Smut",value:"g_smut"},{label:"Xuanhuan",value:"g_xuanhuan"},{label:"Shotacon",value:"g_shotacon"}]}}}return a.prototype.getCheerio=function(a){return e(this,void 0,void 0,(function(){var e,i;return t(this,(function(t){switch(t.label){case 0:return[4,(0,n.fetchApi)(a,{headers:{"Accept-Encoding":"deflate"}})];case 1:return(e=t.sent()).ok?[4,e.text()]:[2,void 0];case 2:return i=t.sent(),[2,(0,r.load)(i)]}}))}))},a.prototype.parseDate=function(e){var t=e.split(" "),a=t[0],r=t[1],n=t[2];return(0,u.default)("".concat(a," ").concat({janvier:1,fevrier:2,mars:3,avril:4,mai:5,juin:6,juillet:7,aout:8,septembre:9,octobre:10,novembre:11,decembre:12}[r.normalize("NFD").replace(/[\u0300-\u036f]/g,"")]," ").concat(n),"D MMMM YYYY").format("DD MMMM YYYY")},a.prototype.parseNovels=function(e,t){var a=this,r=[];return e("article").each((function(n,i){var l,o=e(i),u=o.find("h2").text().trim(),s=o.find("img").attr("src");if(l=t?o.find("span.Roman > a").attr("href"):o.find("h2 > a").attr("href")){var c={name:u,path:l.replace(a.site,""),cover:s};r.push(c)}})),r},a.prototype.popularNovels=function(a,r){return e(this,arguments,void 0,(function(e,a){var r,n,i,l=a.filters,o=a.showLatestNovels;return t(this,(function(t){switch(t.label){case 0:if(r=this.site,o)r+="chapitre";else if(n="all",l&&"string"==typeof l.categorie_genre.value&&(n=l.categorie_genre.value),"all"!=n&&"categorie_roman"!=n&&"genre"!=n)"c"==n[0]?r+="categorie_roman/"+n.substring(2):"g"==n[0]&&(r+="genre/"+n.substring(2));else{if(e>1)return[2,[]];r+="roman"}return r+="/page/"+e,[4,this.getCheerio(r)];case 1:return(i=t.sent())?[2,this.parseNovels(i,o)]:[2,[]]}}))}))},a.prototype.parseNovel=function(a){return e(this,void 0,void 0,(function(){var e,r,n,l,u,s,c,v,h,f,p,d,g=this;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+a)];case 1:if(!(e=t.sent()))throw new Error("Failed to load page (open in web view)");switch((r={path:a,name:"Untitled"}).name=(null===(d=null===(p=e("div.entry-content > div > strong")[0].nextSibling)||void 0===p?void 0:p.nodeValue)||void 0===d?void 0:d.trim())||"Untitled",r.cover=e(".su-row > div > div > img").attr("src")||o.defaultCover,(n=e("div[data-title=Tomes] >").toArray()).pop(),n.shift(),r.summary=e("div[data-title=Synopsis]").text().trim()+"\n\n"+n.map((function(t){return e(t).text()})).join("\n").trim(),r.author=e("strong:contains('Auteur :')").parent().text().replace("Auteur : ","").trim(),r.artist=e("strong:contains('Illustrateur :')").parent().text().replace("Illustrateur :","").trim(),l=e(".categorie").text().replace("Catégorie :","").trim(),u=e(".genre").text().replace("Genre :","").replace(/, /g,",").trim(),l&&"Autre"!=l&&(r.genres=l),u&&(r.genres=r.genres?r.genres+","+u:u),e("strong:contains('Statut :')").parent().attr("class")){case"type etat0":case"type etat1":r.status=i.NovelStatus.Ongoing;break;case"type etat4":r.status=i.NovelStatus.OnHiatus;break;case"type etat5":r.status=i.NovelStatus.Completed;break;case"type etat6":r.status=i.NovelStatus.Cancelled;break;default:r.status=i.NovelStatus.Unknown}return s=[],c=e("div[data-title=Tomes] > div").last().contents(),v=c.length>1,h="",f=this.site,c.each((function(t,a){v&&(h="T."+(t+1)+" "),e(a).find(".chpt").each((function(t,a){var r,n,i,l=e(a),o=h+l.find("a").first().text().trim()||"";if(l.find("i.fa").length){var u=(null===(i=l.find("i").parent().next().html())||void 0===i?void 0:i.split("</a>"))||[];null==u||u.shift();var c=[];null==u||u.forEach((function(e){c.push(e.substring(e.indexOf("(")+1,e.indexOf(")")))}));var v=[];l.find("i").parent().next().find("a").each((function(){v.push(this.attribs.href)})),c.length==v.length&&c.forEach((function(e,a){var r={name:o+" ("+(a+1)+")",releaseTime:g.parseDate(e),path:v[a].replace(f,""),chapterNumber:t+(a+1)/1e3};s.push(r)}))}else{var p=(null===(r=l.html())||void 0===r?void 0:r.substring((null===(n=l.html())||void 0===n?void 0:n.indexOf("</a>"))||0))||"",d=(null==p?void 0:p.substring(p.indexOf("(")+1,p.indexOf(")")))||void 0,b=l.find("a").attr("href");if(b){var m={name:o,releaseTime:g.parseDate(d),path:b.replace(f,""),chapterNumber:t};s.push(m)}}}))})),r.chapters=s,[2,r]}}))}))},a.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+a)];case 1:if(!(e=t.sent()))throw new Error("Failed to load page (open in web view)");return e(".mistape_caption").remove(),[2,e(".chapter-content").html()||e(".entry-content").html()||""]}}))}))},a.prototype.searchNovels=function(a,r){return e(this,void 0,void 0,(function(){var e,n;return t(this,(function(t){switch(t.label){case 0:return 1!==r?[2,[]]:(e=this.site+"roman",[4,this.getCheerio(e)]);case 1:if(!(n=t.sent()))throw new Error("Failed to load page (open in web view)");return[2,this.parseNovels(n,!1).filter((function(e){return e.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().includes(a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim())}))]}}))}))},a}();exports.default=new s;