var t=this&&this.__awaiter||function(t,e,n,a){return new(n||(n=Promise))((function(r,i){function o(t){try{u(a.next(t))}catch(t){i(t)}}function s(t){try{u(a.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((a=a.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var n,a,r,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(n=1,a&&(r=2&s[0]?a.return:s[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,s[1])).done)return r;switch(a=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,a=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],a=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("cheerio"),a=require("@libs/fetch"),r=require("@libs/novelStatus"),i=require("@libs/filterInputs"),o=function(){function o(){this.id="truyenfull",this.name="Truyện Full",this.icon="src/vi/truyenfull/icon.png",this.site="https://truyenfull.io",this.version="1.0.2",this.filters={status:{type:i.FilterTypes.CheckboxGroup,label:"Tình trạng",value:[],options:[{label:"Đã hoàn thành",value:"hoan"}]},sort:{type:i.FilterTypes.Picker,label:"Sắp xếp",value:"",options:[{label:"Truyện mới cập nhật",value:"truyen-moi"},{label:"Truyện hot",value:"truyen-hot"},{label:"Truyện full",value:"truyen-full"},{label:"Tiên hiệp hay",value:"tien-hiep-hay"},{label:"Kiếm hiệp hay",value:"kiem-hiep-hay"},{label:"Truyện teen hay",value:"truyen-teen-hay"},{label:"Ngôn tình hay",value:"ngon-tinh-hay"},{label:"Ngôn tình ngược",value:"ngon-tinh-nguoc"},{label:"Ngôn tình sủng",value:"ngon-tinh-sung"},{label:"Ngôn tình hài",value:"ngon-tinh-hai"},{label:"Đam mỹ hay",value:"dam-my-hay"},{label:"Đam mỹ hài",value:"dam-my-hai"},{label:"Đam mỹ h văn",value:"dam-my-h-van"},{label:"Đam mỹ sắc",value:"dam-my-sac"}]}}}return o.prototype.parseNovels=function(t){var e=this,n=[];return t(".list-truyen .row").each((function(a,r){var i=t(r).find("h3.truyen-title > a").text(),o=t(r).find("div[data-classname='cover']").attr("data-image"),s=t(r).find("h3.truyen-title > a").attr("href");s&&n.push({name:i,cover:o,path:s.replace(e.site,"")})})),n},o.prototype.parseChapters=function(t){var e=this;return t("ul.list-chapter > li > a").toArray().map((function(n){var a,r=n.attribs.href.replace(e.site,"");return{name:t(n).text().trim(),path:r,chapterNumber:Number(null===(a=r.match(/\/chuong-(\d+)\//))||void 0===a?void 0:a[1])}}))},o.prototype.popularNovels=function(r,i){return t(this,arguments,void 0,(function(t,r){var i,o,s,u,l,c,h=r.filters;return e(this,(function(e){switch(e.label){case 0:if(i=this.site+"/danh-sach",h)for(""!==h.sort.value?i+="/".concat(h.sort.value):i+="/truyen-hot",o=0,s=h.status.value;o<s.length;o++)u=s[o],i+="/".concat(u);return i+="/trang-".concat(t),[4,(0,a.fetchApi)(i)];case 1:return[4,e.sent().text()];case 2:return l=e.sent(),c=(0,n.load)(l),[2,this.parseNovels(c)]}}))}))},o.prototype.parseNovel=function(i){return t(this,void 0,void 0,(function(){var t,o,s,u,l;return e(this,(function(e){switch(e.label){case 0:return t=this.site+i,[4,(0,a.fetchApi)(t)];case 1:return[4,e.sent().text()];case 2:return o=e.sent(),s=(0,n.load)(o),u=1,s("ul.pagination.pagination-sm > li > a").each((function(){var t,e=Number(null===(t=this.attribs.href.match(/\/trang-(\d+)\//))||void 0===t?void 0:t[1]);e&&e>u&&(u=e)})),(l={path:i,name:s("div.book > img").attr("alt")||"Không có tiêu đề",chapters:[],totalPages:u}).cover=s("div.book > img").attr("src"),l.summary=s("div.desc-text").text().trim(),l.author=s('h3:contains("Tác giả:")').parent().contents().text().replace("Tác giả:",""),l.genres=s('h3:contains("Thể loại")').siblings().map((function(t,e){return s(e).text()})).toArray().join(","),l.status=s('h3:contains("Trạng thái")').next().text(),"Full"===l.status?l.status=r.NovelStatus.Completed:"Đang ra"===l.status?l.status=r.NovelStatus.Ongoing:l.status=r.NovelStatus.Unknown,l.chapters=this.parseChapters(s),[2,l]}}))}))},o.prototype.parsePage=function(r,i){return t(this,void 0,void 0,(function(){var t,o,s;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site).concat(r,"trang-").concat(i,"/#list-chapter"),[4,(0,a.fetchApi)(t)];case 1:return[4,e.sent().text()];case 2:return o=e.sent(),s=(0,n.load)(o),[2,{chapters:this.parseChapters(s)}]}}))}))},o.prototype.parseChapter=function(r){return t(this,void 0,void 0,(function(){var t,i;return e(this,(function(e){switch(e.label){case 0:return[4,(0,a.fetchApi)(this.site+r)];case 1:return[4,e.sent().text()];case 2:return t=e.sent(),i=(0,n.load)(t),[2,(i(".chapter-title").html()||"")+(i("#chapter-c").html()||"")]}}))}))},o.prototype.searchNovels=function(r,i){return t(this,void 0,void 0,(function(){var t,o,s;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site,"/tim-kiem?tukhoa=").concat(r,"&page=").concat(i),[4,(0,a.fetchApi)(t)];case 1:return[4,e.sent().text()];case 2:return o=e.sent(),s=(0,n.load)(o),[2,this.parseNovels(s)]}}))}))},o}();exports.default=new o;