var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function l(e){try{u(r.next(e))}catch(e){o(e)}}function i(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,i)}u((r=r.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var n,r,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=i(0),l.throw=i(1),l.return=i(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function i(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,i[0]&&(o=0)),o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("cheerio"),r=require("@libs/fetch"),a=require("@libs/filterInputs"),o=require("@libs/defaultCover"),l=function(){function l(){this.id="rewayatclub",this.name="Rewayat Club",this.version="1.0.1",this.icon="src/ar/rewayatclub/icon.png",this.site="https://rewayat.club/",this.filters={genre:{value:[],label:"Genres",options:[{label:"كوميديا",value:"1"},{label:"أكشن",value:"2"},{label:"دراما",value:"3"},{label:"فانتازيا",value:"4"},{label:"مهارات القتال",value:"5"},{label:"مغامرة",value:"6"},{label:"رومانسي",value:"7"},{label:"خيال علمي",value:"8"},{label:"الحياة المدرسية",value:"9"},{label:"قوى خارقة",value:"10"},{label:"سحر",value:"11"},{label:"رياضة",value:"12"},{label:"رعب",value:"13"},{label:"حريم",value:"14"}],type:a.FilterTypes.CheckboxGroup},categories:{value:"0",label:"الفئات",options:[{label:"جميع الروايات",value:"0"},{label:"مترجمة",value:"1"},{label:"مؤلفة",value:"2"},{label:"مكتملة",value:"3"}],type:a.FilterTypes.Picker},sortOptions:{value:"-num_chapters",label:"الترتيب",options:[{label:"عدد الفصول - من أقل ﻷعلى",value:"num_chapters"},{label:"عدد الفصول - من أعلى ﻷقل",value:"-num_chapters"},{label:"الاسم - من أقل ﻷعلى",value:"english"},{label:"الاسم - من أعلى ﻷقل",value:"-english"}],type:a.FilterTypes.Picker}}}return l.prototype.parseNovels=function(e){var t=[];return e.results.map((function(e){var n;t.push({name:e.arabic||(null===(n=e.novel)||void 0===n?void 0:n.arabic)||"novel",path:e.slug?"novel/".concat(e.slug):e.novel?"novel/".concat(e.novel.slug):"novel",cover:e.poster_url?"https://api.rewayat.club/".concat(e.poster_url.slice(1)):e.novel?"https://api.rewayat.club/".concat(e.novel.poster_url.slice(1)):o.defaultCover})})),t},l.prototype.popularNovels=function(n,a){return e(this,arguments,void 0,(function(e,n){var a,o,l=n.showLatestNovels,i=n.filters;return t(this,(function(t){switch(t.label){case 0:return a="https://api.rewayat.club/api/novels/",o={count:0,next:"",previous:"",results:[]},l?(a="".concat(this.site,"api/chapters/weekly/list/?page=").concat(e),[4,(0,r.fetchApi)(a).then((function(e){return e.json()}))]):[3,2];case 1:return o=t.sent(),[3,4];case 2:return i?(""!==i.categories.value&&(a+="?type=".concat(i.categories.value)),""!==i.sortOptions.value&&(a+="&ordering=".concat(i.sortOptions.value)),i.genre.value.length>0&&i.genre.value.forEach((function(e){a+="&genre=".concat(e)})),a+="&page=".concat(e),[4,(0,r.fetchApi)(a).then((function(e){return e.json()}))]):[3,4];case 3:o=t.sent(),t.label=4;case 4:return[2,this.parseNovels(o)]}}))}))},l.prototype.parseNovel=function(a){return e(this,void 0,void 0,(function(){var e,l,i,u,c,s,p,h,v,f,b,y,d,g,m;return t(this,(function(t){switch(t.label){case 0:return[4,(0,r.fetchApi)(new URL(a,this.site).toString())];case 1:return[4,t.sent().text()];case 2:return e=t.sent(),l=(0,n.load)(e),i={path:a,name:l("h1.primary--text span").text().trim()||"Untitled",author:l(".novel-author").text().trim(),summary:l("div.text-pre-line span").text().trim(),totalPages:1,chapters:[]},u=new Set(["مكتملة","متوقفة","مستمرة"]),c=Array.from(l(".v-slide-group__content a")).map((function(e){return l(e).text().trim()})).join(","),s=Array.from(l("div.v-slide-group__content span.v-chip__content")).map((function(e){return l(e).text().trim()})).filter((function(e){return u.has(e)})),i.genres="".concat(s,",").concat(c),p=Array.from(l("div.v-slide-group__content span.v-chip__content")).map((function(e){return l(e).text().trim()})).filter((function(e){return u.has(e)})).join(),i.status={"متوقفة":"On Hiatus","مكتملة":"Completed","مستمرة":"Ongoing"}[p]||"Unknown",h=l('body script:contains("__NUXT__")').first().text(),v=/poster_url:"(\\u002F[^"]+)"/,f=null==h?void 0:h.match(v),b=f?f[1].replace(/\\u002F/g,"/").replace(/^\/*/,""):o.defaultCover,y="https://api.rewayat.club/".concat(b),i.cover=y,d=l("div.v-tab--active span.mr-1").text().replace(/[^\d]/g,""),g=parseInt(d,10),m=Math.ceil(g/24),i.totalPages=m,[2,i]}}))}))},l.prototype.parseChapters=function(e,t){var n=[];return e.results.map((function(e){n.push({name:e.title,releaseTime:new Date(e.date).toISOString(),path:"".concat(t,"/").concat(e.number),chapterNumber:e.number})})),n},l.prototype.parsePage=function(n,a){return e(this,void 0,void 0,(function(){var e,o,l;return t(this,(function(t){switch(t.label){case 0:return e=n.slice(6),o="https://api.rewayat.club/api/chapters/".concat(e,"/?ordering=number&page=").concat(a),[4,(0,r.fetchApi)(o).then((function(e){return e.json()}))];case 1:return l=t.sent(),[2,{chapters:this.parseChapters(l,n)}]}}))}))},l.prototype.parseChapter=function(n){return e(this,void 0,void 0,(function(){var e,a;return t(this,(function(t){switch(t.label){case 0:return e=this.site+"api/chapters/"+n.slice(6),[4,(0,r.fetchApi)(e).then((function(e){return e.json()}))];case 1:return a=t.sent(),[2,a.content.flat().join("").replace(/<p>\n|\n<p>\n/g,"").trim()]}}))}))},l.prototype.searchNovels=function(n,a){return e(this,void 0,void 0,(function(){var e,o;return t(this,(function(t){switch(t.label){case 0:return e="https://api.rewayat.club/api/novels/?type=0&ordering=-num_chapters&page=".concat(a,"&search=").concat(n),[4,(0,r.fetchApi)(e).then((function(e){return e.json()}))];case 1:return o=t.sent(),[2,this.parseNovels(o)]}}))}))},l}();exports.default=new l;