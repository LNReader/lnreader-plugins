var e=this&&this.__awaiter||function(e,t,a,l){return new(a||(a=Promise))((function(r,n){function i(e){try{o(l.next(e))}catch(e){n(e)}}function u(e){try{o(l.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,u)}o((l=l.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,l,r,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(o){return function(u){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(n=0)),n;)try{if(a=1,l&&(r=2&u[0]?l.return:u[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,u[1])).done)return r;switch(l=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,l=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(!(r=n.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){n=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){n.label=u[1];break}if(6===u[0]&&n.label<r[1]){n.label=r[1],r=u;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(u);break}r[2]&&n.ops.pop(),n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e],l=0}finally{a=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,o])}}};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("cheerio"),l=require("@libs/fetch"),r=require("@libs/filterInputs"),n=require("@libs/defaultCover"),i=function(){function i(){this.id="sunovels",this.name="Sunovels",this.version="1.0.0",this.icon="src/ar/sunovels/icon.png",this.site="https://sunovels.com/",this.filters={categories:{value:[],label:"التصنيفات",options:[{label:"Wuxia",value:"Wuxia"},{label:"Xianxia",value:"Xianxia"},{label:"XUANHUAN",value:"XUANHUAN"},{label:"أصلية",value:"أصلية"},{label:"أكشن",value:"أكشن"},{label:"إثارة",value:"إثارة"},{label:"إنتقال الى عالم أخر",value:"إنتقال+الى+عالم+أخر"},{label:"إيتشي",value:"إيتشي"},{label:"الخيال العلمي",value:"الخيال+العلمي"},{label:"بوليسي",value:"بوليسي"},{label:"تاريخي",value:"تاريخي"},{label:"تقمص شخصيات",value:"تقمص+شخصيات"},{label:"جريمة",value:"جريمة"},{label:"جوسى",value:"جوسى"},{label:"حريم",value:"حريم"},{label:"حياة مدرسية",value:"حياة+مدرسية"},{label:"خارقة للطبيعة",value:"خارقة+للطبيعة"},{label:"خيالي",value:"خيالي"},{label:"دراما",value:"دراما"},{label:"رعب",value:"رعب"},{label:"رومانسي",value:"رومانسي"},{label:"سحر",value:"سحر"},{label:"سينن",value:"سينن"},{label:"شريحة من الحياة",value:"شريحة+من+الحياة"},{label:"شونين",value:"شونين"},{label:"غموض",value:"غموض"},{label:"فنون القتال",value:"فنون+القتال"},{label:"قوى خارقة",value:"قوى+خارقة"},{label:"كوميدى",value:"كوميدى"},{label:"مأساوي",value:"مأساوي"},{label:"ما بعد الكارثة",value:"ما+بعد+الكارثة"},{label:"مغامرة",value:"مغامرة"},{label:"ميكا",value:"ميكا"},{label:"ناضج",value:"ناضج"},{label:"نفسي",value:"نفسي"},{label:"فانتازيا",value:"فانتازيا"},{label:"رياضة",value:"رياضة"},{label:"ابراج",value:"ابراج"},{label:"الالهة",value:"الالهة"},{label:"شياطين",value:"شياطين"},{label:"السفر عبر الزمن",value:"السفر+عبر+الزمن"},{label:"رواية صينية",value:"رواية+صينية"},{label:"رواية ويب",value:"رواية+ويب"},{label:"لايت نوفل",value:"لايت+نوفل"},{label:"كوري",value:"كوري"},{label:"+18",value:"%2B18"},{label:"إيسكاي",value:"إيسكاي"},{label:"ياباني",value:"ياباني"},{label:"مؤلفة",value:"مؤلفة"}],type:r.FilterTypes.CheckboxGroup},status:{value:"",label:"الحالة",options:[{label:"جميع الروايات",value:""},{label:"مكتمل",value:"Completed"},{label:"جديد",value:"New"},{label:"مستمر",value:"Ongoing"}],type:r.FilterTypes.Picker}}}return i.prototype.parseNovels=function(e){var t=this,a=[],l=[];e("script").each((function(t,a){var r=e(a).text().match(/\/uploads\/[^\s"]+/g);r&&l.push.apply(l,r)}));var r=0;return e(".list-item").each((function(i,u){e(u).find("a").each((function(i,u){var o,s=e(u).find("h4").text().trim(),c=(null===(o=e(u).attr("href"))||void 0===o?void 0:o.trim().replace(/^\/*/,""))||"",v=n.defaultCover;if(l.length>0)v=t.site+l[r].slice(1);else{var p=e(u).find("img").attr("src");v=t.site+(null==p?void 0:p.slice(1))}var h={name:s,cover:v,path:c};r++,a.push(h)}))})),a},i.prototype.popularNovels=function(r,n){return e(this,arguments,void 0,(function(e,r){r.showLatestNovels;var n,i,u,o,s=r.filters;return t(this,(function(t){switch(t.label){case 0:return n=e-1,i="".concat(this.site,"library?"),s&&(Array.isArray(s.categories.value)&&s.categories.value.length>0&&s.categories.value.forEach((function(e){i+="&category=".concat(e)})),""!==s.status.value&&(i+="&status=".concat(s.status.value))),i+="&page=".concat(n),[4,(0,l.fetchApi)(i).then((function(e){return e.text()}))];case 1:return u=t.sent(),o=(0,a.load)(u),[2,this.parseNovels(o)]}}))}))},i.prototype.parseNovel=function(r){return e(this,void 0,void 0,(function(){var e,n,i,u,o,s,c,v,p,h,f,b;return t(this,(function(t){switch(t.label){case 0:return[4,(0,l.fetchApi)(new URL(r,this.site).toString())];case 1:return[4,t.sent().text()];case 2:return e=t.sent(),n=(0,a.load)(e),i={path:r,name:n("div.main-head h3").text().trim()||"Untitled",author:n(".novel-author").text().trim(),summary:n("section.info-section div.description p").text().trim(),totalPages:1,chapters:[]},u=new Set(["مكتمل","جديد","مستمر"]),o=Array.from(n("div.categories li.tag")).map((function(e){return n(e).text().trim()})).join(","),s=Array.from(n("div.header-stats span").eq(3).find("strong")).map((function(e){return n(e).text().trim()})).filter((function(e){return u.has(e)})),i.genres="".concat(s,",").concat(o),c=Array.from(n("div.header-stats span").eq(3).find("strong")).map((function(e){return n(e).text().trim()})).filter((function(e){return u.has(e)})).join(),i.status={"جديد":"Ongoing","مكتمل":"Completed","مستمر":"Ongoing"}[c]||"Unknown",v=n("div.img-container figure.cover img").attr("src"),p=this.site+(null==v?void 0:v.slice(1)),i.cover=p,h=n("div.header-stats span").first().text().replace(/[^\d]/g,""),f=parseInt(h,10),b=Math.ceil(f/50),i.totalPages=b,[2,i]}}))}))},i.prototype.parseChapters=function(e){var t=[];return e.chapters.map((function(e){t.push({name:e.chapterName,releaseTime:new Date(e.releaseTime).toISOString(),path:e.chapterUrl,chapterNumber:e.chapterNumber})})),t},i.prototype.parsePage=function(r,n){return e(this,void 0,void 0,(function(){var e,i,u,o,s,c,v,p,h,f;return t(this,(function(t){switch(t.label){case 0:return e=parseInt(n,10),i=e-1,u=r,o=this.site+u,s=o+"?activeTab=chapters&page="+i,[4,(0,l.fetchApi)(s).then((function(e){return e.text()}))];case 1:return c=t.sent(),v=(0,a.load)(c),p={pages_count:"",chapters:[]},h=[],v("ul.chaptersList a").each((function(e,t){var a,l,r=null!==(a=v(t).attr("title"))&&void 0!==a?a:"",n=null===(l=v(t).attr("href"))||void 0===l?void 0:l.trim().replace(/^\/*/,""),i=v(t).find("time.chapter-update").attr("datetime"),u=new Date(i).toISOString(),o=v(t).find("strong.chapter-title").text().replace(/[^\d٠-٩]/g,""),s=parseInt(o,10);h.push({chapterName:r,chapterUrl:n||"",releaseTime:u||"",chapterNumber:s||""})})),f=v("ul.pagination a.active").text(),p.pages_count=f,p.chapters=h,[2,{chapters:this.parseChapters(p)}]}}))}))},i.prototype.parseChapter=function(r){return e(this,void 0,void 0,(function(){var e,n,i;return t(this,(function(t){switch(t.label){case 0:return[4,(0,l.fetchApi)(new URL(r,this.site).toString())];case 1:return[4,t.sent().text()];case 2:return e=t.sent(),n=(0,a.load)(e),i="",n("div.chapter-content").each((function(e,t){n(t).find("p").not(".d-none").each((function(e,t){i+=n(t).map((function(e,t){return n(t).text().trim()})).get().join(" ")+" "}))})),[2,i=i.trim()]}}))}))},i.prototype.searchNovels=function(r,n){return e(this,void 0,void 0,(function(){var e,i,u;return t(this,(function(t){switch(t.label){case 0:return e="".concat(this.site,"search?page=").concat(n,"&title=").concat(r),[4,(0,l.fetchApi)(e)];case 1:return[4,t.sent().text()];case 2:return i=t.sent(),u=(0,a.load)(i),[2,this.parseNovels(u)]}}))}))},i}();exports.default=new i;