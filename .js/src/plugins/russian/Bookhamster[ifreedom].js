var e=this&&this.__awaiter||function(e,t,a,l){return new(a||(a=Promise))((function(r,n){function i(e){try{o(l.next(e))}catch(e){n(e)}}function u(e){try{o(l.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,u)}o((l=l.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,l,r,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(o){return function(u){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(n=0)),n;)try{if(a=1,l&&(r=2&u[0]?l.return:u[0]?l.throw||((r=l.return)&&r.call(l),0):l.next)&&!(r=r.call(l,u[1])).done)return r;switch(l=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,l=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(!(r=n.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){n=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){n.label=u[1];break}if(6===u[0]&&n.label<r[1]){n.label=r[1],r=u;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(u);break}r[2]&&n.ops.pop(),n.trys.pop();continue}u=t.call(e,n)}catch(e){u=[6,e],l=0}finally{a=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,o])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var l=require("@libs/fetch"),r=require("@libs/filterInputs"),n=require("@libs/novelStatus"),i=require("cheerio"),u=a(require("dayjs")),o=new(function(){function a(e){this.parseDate=function(e){void 0===e&&(e="");var t={"января":1,"февраля":2,"марта":3,"апреля":4,"мая":5,"июня":6,"июля":7,"августа":8,"сентября":9,"октября":10,"ноября":11,"декабря":12};if(e.includes(".")){var a=e.split("."),l=a[0],r=a[1],n=a[2];if(l&&r&&n)return(0,u.default)(n+"-"+r+"-"+l).format("LL")}else if(e.includes(" ")){var i=e.split(" ");l=i[0],r=i[1];if(l&&t[r]){n=(new Date).getFullYear();return(0,u.default)(n+"-"+t[r]+"-"+l).format("LL")}}return e||null},this.id=e.id,this.name=e.sourceName,this.icon="multisrc/ifreedom/".concat(e.id.toLowerCase(),"/icon.png"),this.site=e.sourceSite,this.version="1.0.2",this.filters=e.filters}return a.prototype.popularNovels=function(a,r){return e(this,arguments,void 0,(function(e,a){var r,n,u,o,s,c=this,v=a.filters,b=a.showLatestNovels;return t(this,(function(t){switch(t.label){case 0:return r=this.site+"/vse-knigi/?sort="+(b?"По дате обновления":(null===(s=null==v?void 0:v.sort)||void 0===s?void 0:s.value)||"По рейтингу"),Object.entries(v||{}).forEach((function(e){var t=e[0],a=e[1].value;a instanceof Array&&a.length&&(r+="&"+t+"[]="+a.join("&"+t+"[]="))})),r+="&bpage="+e,[4,(0,l.fetchApi)(r).then((function(e){return e.text()}))];case 1:return n=t.sent(),u=(0,i.load)(n),o=u("div.one-book-home > div.img-home a").map((function(e,t){var a,l;return{name:u(t).attr("title")||"",cover:u(t).find("img").attr("src"),path:(null===(l=null===(a=u(t).attr("href"))||void 0===a?void 0:a.replace)||void 0===l?void 0:l.call(a,c.site,""))||""}})).get().filter((function(e){return e.name&&e.path})),[2,o]}}))}))},a.prototype.parseNovel=function(a){return e(this,void 0,void 0,(function(){var e,r,u,o,s,c=this;return t(this,(function(t){switch(t.label){case 0:return[4,(0,l.fetchApi)(this.site+a).then((function(e){return e.text()}))];case 1:return e=t.sent(),r=(0,i.load)(e),u={path:a,name:r(".entry-title").text(),cover:r(".img-ranobe > img").attr("src"),summary:r('meta[name="description"]').attr("content")},r("div.data-ranobe").each((function(){switch(r(this).find("b").text()){case"Автор":u.author=r(this).find("div.data-value").text().trim();break;case"Жанры":u.genres=r("div.data-value > a").map((function(e,t){var a;return null===(a=r(t).text())||void 0===a?void 0:a.trim()})).get().join(",");break;case"Статус книги":u.status=r("div.data-value").text().includes("активен")?n.NovelStatus.Ongoing:n.NovelStatus.Completed}})),"Не указан"==u.author&&delete u.author,o=[],s=r("div.li-ranobe").length,r("div.li-ranobe").each((function(e,t){var a=r(t).find("a").text(),l=r(t).find("a").attr("href");if(!r(t).find("label.buy-ranobe").length&&a&&l){var n=r(t).find("div.li-col2-ranobe").text().trim();o.push({name:a,path:l.replace(c.site,""),releaseTime:c.parseDate(n),chapterNumber:s-e})}})),u.chapters=o.reverse(),[2,u]}}))}))},a.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var e,r,n;return t(this,(function(t){switch(t.label){case 0:return[4,(0,l.fetchApi)(this.site+a).then((function(e){return e.text()}))];case 1:return e=t.sent(),(r=(r=(null===(n=e.match(/<article id="([\s\S]*?)<\/article>/))||void 0===n?void 0:n[0])||"").replace(/<script[^>]*>[\s\S]*?<\/script>/gim,"")).includes("<img")?[2,r.replace(/srcset="([^"]+)"/g,(function(e,t){if(!t)return e;var a=t.split(" ").filter((function(e){return e.startsWith("http")})).pop();return a?'src="'.concat(a,'"'):e}))]:[2,r]}}))}))},a.prototype.searchNovels=function(a){return e(this,arguments,void 0,(function(e,a){var r,n,u,o,s=this;return void 0===a&&(a=1),t(this,(function(t){switch(t.label){case 0:return r=this.site+"/vse-knigi/?searchname="+encodeURIComponent(e)+"&bpage="+a,[4,(0,l.fetchApi)(r).then((function(e){return e.text()}))];case 1:return n=t.sent(),u=(0,i.load)(n),o=u("div.one-book-home > div.img-home a").map((function(e,t){var a,l;return{name:u(t).attr("title")||"",cover:u(t).find("img").attr("src"),path:(null===(l=null===(a=u(t).attr("href"))||void 0===a?void 0:a.replace)||void 0===l?void 0:l.call(a,s.site,""))||""}})).get().filter((function(e){return e.name&&e.path})),[2,o]}}))}))},a}())({id:"bookhamster",sourceSite:"https://bookhamster.ru",sourceName:"Bookhamster",filters:{sort:{type:r.FilterTypes.Picker,label:"Сортировка:",options:[{label:"По дате добавления",value:"По дате добавления"},{label:"По дате обновления",value:"По дате обновления"},{label:"По количеству глав",value:"По количеству глав"},{label:"По названию",value:"По названию"},{label:"По просмотрам",value:"По просмотрам"},{label:"По рейтингу",value:"По рейтингу"}],value:"По рейтингу"},status:{type:r.FilterTypes.CheckboxGroup,label:"Статус:",options:[{label:"Перевод активен",value:"Перевод активен"},{label:"Перевод приостановлен",value:"Перевод приостановлен"},{label:"Произведение завершено",value:"Произведение завершено"}],value:[]},lang:{type:r.FilterTypes.CheckboxGroup,label:"Язык:",options:[{label:"Английский",value:"Английский"},{label:"Китайский",value:"Китайский"},{label:"Корейский",value:"Корейский"},{label:"Японский",value:"Японский"}],value:[]},genre:{type:r.FilterTypes.CheckboxGroup,label:"Жанры:",options:[{label:"Боевик",value:"Боевик"},{label:"Боевые Искусства",value:"Боевые Искусства"},{label:"Вампиры",value:"Вампиры"},{label:"Виртуальный Мир",value:"Виртуальный Мир"},{label:"Гарем",value:"Гарем"},{label:"Героическое фэнтези",value:"Героическое фэнтези"},{label:"Детектив",value:"Детектив"},{label:"Дзёсэй",value:"Дзёсэй"},{label:"Драма",value:"Драма"},{label:"Игра",value:"Игра"},{label:"История",value:"История"},{label:"Киберпанк",value:"Киберпанк"},{label:"Комедия",value:"Комедия"},{label:"ЛитРПГ",value:"ЛитРПГ"},{label:"Меха",value:"Меха"},{label:"Милитари",value:"Милитари"},{label:"Мистика",value:"Мистика"},{label:"Научная Фантастика",value:"Научная Фантастика"},{label:"Повседневность",value:"Повседневность"},{label:"Постапокалипсис",value:"Постапокалипсис"},{label:"Приключения",value:"Приключения"},{label:"Психология",value:"Психология"},{label:"Романтика",value:"Романтика"},{label:"Сверхъестественное",value:"Сверхъестественное"},{label:"Сёдзё",value:"Сёдзё"},{label:"Сёнэн",value:"Сёнэн"},{label:"Сёнэн-ай",value:"Сёнэн-ай"},{label:"Спорт",value:"Спорт"},{label:"Сэйнэн",value:"Сэйнэн"},{label:"Сюаньхуа",value:"Сюаньхуа"},{label:"Трагедия",value:"Трагедия"},{label:"Триллер",value:"Триллер"},{label:"Ужасы",value:"Ужасы"},{label:"Фантастика",value:"Фантастика"},{label:"Фэнтези",value:"Фэнтези"},{label:"Школьная жизнь",value:"Школьная жизнь"},{label:"Экшн",value:"Экшн"},{label:"Эротика",value:"Эротика"},{label:"Этти",value:"Этти"},{label:"Яой",value:"Яой"},{label:"Adult",value:"Adult"},{label:"Mature",value:"Mature"},{label:"Xianxia",value:"Xianxia"},{label:"Xuanhuan",value:"Xuanhuan"}],value:[]}}});exports.default=o;