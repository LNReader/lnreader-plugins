var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/filterInputs"),n=require("@libs/defaultCover"),o=require("@libs/fetch"),i={"Content-Type":"application/json","X-Inertia":!0,"X-Inertia-Version":"6666cd76f96956469e7be39d750cc7d9"},s=function(){function s(){var e=this;this.id="freedlit.space",this.name="LitSpace",this.site="https://freedlit.space",this.version="1.1.0",this.icon="src/ru/freedlit/icon.png",this.resolveUrl=function(t,r){return e.site+(r?"/book/":"/reader/")+t},this.getToken=function(e){for(var t=0,r=(e.map["set-cookie"]||"").split("; ");t<r.length;t++){var n=r[t].split("="),o=n[0],s=n[1];if("XSRF-TOKEN"===o)return void(i["X-XSRF-TOKEN"]=decodeURIComponent(s))}if(!i["X-XSRF-TOKEN"])throw new Error("Failed to find the token")},this.filters={sort:{label:"Сортировка:",value:"popular",options:[{label:"По популярности",value:"popular"},{label:"последние обновления",value:"updated"},{label:"По новизне",value:"recent"},{label:"По просмотрам",value:"views"},{label:"По количеству лайков",value:"likes"}],type:r.FilterTypes.Picker},access:{label:"Доступ:",value:"all",options:[{label:"Любой доступ",value:"all"},{label:"Бесплатные",value:"free"},{label:"Платные",value:"paid"}],type:r.FilterTypes.Picker},hideAdult:{label:"Скрыть 18+",value:!0,type:r.FilterTypes.Switch}}}return s.prototype.popularNovels=function(r,i){return e(this,arguments,void 0,(function(e,r){var i,s,a,l,u,c=this,h=r.showLatestNovels,p=r.filters;return t(this,(function(t){switch(t.label){case 0:return i=this.site+"/get-books/?sort=",i+=h?"recent":(null===(a=null==p?void 0:p.sort)||void 0===a?void 0:a.value)||"popular",i+="&access="+((null===(l=null==p?void 0:p.access)||void 0===l?void 0:l.value)||"all"),i+="&hideAdult="+((null===(u=null==p?void 0:p.hideAdult)||void 0===u?void 0:u.value)||!1),i+="&page="+e,s=[],[4,(0,o.fetchApi)(i).then((function(e){return c.getToken(e.headers),e.json()}))];case 1:return t.sent().books.data.forEach((function(e){return s.push({name:e.title,cover:e.cover?c.site+"/storage/"+e.cover:n.defaultCover,path:e.item_id.toString()})})),[2,s]}}))}))},s.prototype.parseNovel=function(r){return e(this,void 0,void 0,(function(){var e,s,a,l,u,c,h,p,d,f,v,b=this;return t(this,(function(t){switch(t.label){case 0:return[4,(0,o.fetchApi)(this.resolveUrl(r,!0),{headers:i,Referer:this.resolveUrl(r,!0)}).then((function(e){return b.getToken(e.headers),e.json()}))];case 1:return e=t.sent().props.book,s={path:r,name:e.title,cover:e.cover?this.site+"/storage/"+e.cover:n.defaultCover,summary:e.annotation,author:(null===(c=null===(u=e.authors_names)||void 0===u?void 0:u[0])||void 0===c?void 0:c.name)||"",genres:(null===(f=null===(d=null===(p=null===(h=e.tags)||void 0===h?void 0:h.map)||void 0===p?void 0:p.call(h,(function(e){return e.name})))||void 0===d?void 0:d.join)||void 0===f?void 0:f.call(d,", "))||""},[4,(0,o.fetchApi)(this.site+"/api/bookpage/get-chapters",{method:"post",headers:i,Referer:this.resolveUrl(r),body:JSON.stringify({book_id:r})}).then((function(e){return b.getToken(e.headers),e.json()}))];case 2:return a=t.sent().success,l=[],(null===(v=null==a?void 0:a.items)||void 0===v?void 0:v.length)&&a.items.forEach((function(e,t){return l.push({name:e.header,path:r+"/"+e.id,releaseTime:e.first_published_formated,chapterNumber:t+1})})),s.chapters=l,[2,s]}}))}))},s.prototype.parseChapter=function(r){return e(this,void 0,void 0,(function(){var e,n,s,a,l=this;return t(this,(function(t){switch(t.label){case 0:return e=r.split("/"),n=e[0],s=e[1],i["X-XSRF-TOKEN"]?[3,2]:[4,(0,o.fetchApi)(this.site).then((function(e){return l.getToken(e.headers)}))];case 1:t.sent(),t.label=2;case 2:return[4,(0,o.fetchApi)(this.site+"/reader/get-content",{method:"post",headers:i,Referer:this.resolveUrl(r),body:JSON.stringify({book_id:n,chapter_id:s})}).then((function(e){return l.getToken(e.headers),e.json()}))];case 3:return a=t.sent().success,[2,a.content]}}))}))},s.prototype.searchNovels=function(r){return e(this,void 0,void 0,(function(){var e,i,s=this;return t(this,(function(t){switch(t.label){case 0:return[4,(0,o.fetchApi)(this.site+"/api/search?query="+r).then((function(e){return s.getToken(e.headers),e.json()}))];case 1:return e=t.sent().success,i=[],(null==e?void 0:e.length)&&e.forEach((function(e){"book"===e.type&&e.title&&i.push({name:e.title,cover:e.cover?s.site+"/storage/"+e.cover:n.defaultCover,path:e.id.toString()})})),[2,i]}}))}))},s}();exports.default=new s;