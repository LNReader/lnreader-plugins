var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,i){function l(e){try{u(n.next(e))}catch(e){i(e)}}function o(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(l,o)}u((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},l=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return l.next=o(0),l.throw=o(1),l.return=o(2),"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function o(o){return function(u){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;l&&(l=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),n=require("cheerio"),a=require("@libs/filterInputs"),i=function(){function i(){this.id="FWN.com",this.name="Free Web Novel",this.site="https://freewebnovel.com/",this.version="1.2.0",this.icon="src/en/freewebnovel/icon.png",this.lastSearch=null,this.searchInterval=3400,this.filters={genres:{type:a.FilterTypes.Picker,label:"Genre",value:"",options:[{label:"Action",value:"genre/Action/"},{label:"Adult",value:"genre/Adult/"},{label:"Adventure",value:"genre/Adventure/"},{label:"Comedy",value:"genre/Comedy/"},{label:"Drama",value:"genre/Drama/"},{label:"Eastern",value:"genre/Eastern"},{label:"Ecchi",value:"genre/Ecchi/"},{label:"Fantasy",value:"genre/Fantasy/"},{label:"Gender Bender",value:"genre/Gender+Bender/"},{label:"Harem",value:"genre/Harem/"},{label:"Historical",value:"genre/Historical/"},{label:"Horror",value:"genre/Horror/"},{label:"Josei",value:"genre/Josei/"},{label:"Game",value:"genre/Game/"},{label:"Martial Arts",value:"genre/Martial+Arts/"},{label:"Mature",value:"genre/Mature/"},{label:"Mecha",value:"genre/Mecha/"},{label:"Mystery",value:"genre/Mystery/"},{label:"Psychological",value:"genre/Psychological/"},{label:"Reincarnation",value:"genre/Reincarnation"},{label:"Romance",value:"genre/Romance/"},{label:"School Life",value:"genre/School+Life/"},{label:"Sci-fi",value:"genre/Sci-fi/"},{label:"Seinen",value:"genre/Seinen/"},{label:"Shoujo",value:"genre/Shoujo/"},{label:"Shounen Ai",value:"genre/Shounen+Ai/"},{label:"Shounen",value:"genre/Shounen/"},{label:"Slice of Life",value:"genre/Slice+of+Life/"},{label:"Smut",value:"genre/Smut/"},{label:"Sports",value:"genre/Sports/"},{label:"Supernatural",value:"genre/Supernatural/"},{label:"Tragedy",value:"genre/Tragedy/"},{label:"Wuxia",value:"genre/Wuxia/"},{label:"Xianxia",value:"genre/Xianxia/"},{label:"Xuanhuan",value:"genre/Xuanhuan/"},{label:"Yaoi",value:"genre/Yaoi/"}]}}}return i.prototype.sleep=function(r){return e(this,void 0,void 0,(function(){return t(this,(function(e){return[2,new Promise((function(e){return setTimeout(e,r)}))]}))}))},i.prototype.getCheerio=function(a){return e(this,void 0,void 0,(function(){var e,i;return t(this,(function(t){switch(t.label){case 0:return[4,(0,r.fetchApi)(a)];case 1:if(!(e=t.sent()).ok)throw new Error("Could not reach site (".concat(e.status,": ").concat(e.statusText,") try to open in webview."));return i=n.load,[4,e.text()];case 2:return[2,i.apply(void 0,[t.sent()])]}}))}))},i.prototype.parseNovels=function(e){var t=this;return e(".li-row").toArray().map((function(r){var n,a=e(r),i=a.find(".tit").text().trim(),l=null===(n=a.find("h3 > a").attr("href"))||void 0===n?void 0:n.slice(1);if(!i||!l)return null;var o=a.find("img").attr("src")||"";return{name:i,cover:o.startsWith("http")?o:t.site+o,path:l}})).filter(Boolean)},i.prototype.popularNovels=function(r,n){return e(this,arguments,void 0,(function(e,r){var n,a,i,l,o=r.showLatestNovels,u=r.filters;return t(this,(function(t){switch(t.label){case 0:if(o)n="sort/latest-novels/";else if(null===(l=null==u?void 0:u.genres)||void 0===l?void 0:l.value)n=u.genres.value;else{if(1!==e)return[2,[]];n="most-popular/",e=0}return a="".concat(this.site).concat(n).concat(e),[4,this.getCheerio(a)];case 1:return i=t.sent(),[2,this.parseNovels(i)]}}))}))},i.prototype.parseNovel=function(r){return e(this,void 0,void 0,(function(){var e,n,a,i;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+r)];case 1:return e=t.sent(),n={path:r},a=e(".m-imgtxt img"),n.name=a.attr("title"),n.cover=this.site+a.attr("src"),e(".m-imgtxt .item").each((function(t,r){var a=e(r);switch(a.find("span").attr("title")){case"Author":n.author=a.find(".right a").text();break;case"Status":n.status=a.find(".right span").text();break;case"Genre":n.genres=a.find(".right a").map((function(t,r){return e(r).text()})).toArray().join(", ")}})),n.summary=e(".inner p").toArray().map((function(t){return e(t).text().trim()})).join("\n"),i=e("#idData > li > a").toArray().map((function(t,n){var a=e(t),i=a.attr("title")||"Chapter ".concat(n+1),l=a.attr("href");return{name:i,path:(null==l?void 0:l.slice(1))||r.replace(".html","/chapter-".concat(n+1,".html")),releaseTime:null,chapterNumber:n+1}})),n.chapters=i,[2,n]}}))}))},i.prototype.parseChapter=function(r){return e(this,void 0,void 0,(function(){var e,n,a;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+r)];case 1:return e=t.sent(),n=null===(a=e(".footer").prev().text().match(/e\("([^]+?)"/))||void 0===a?void 0:a[1],[2,(e("div.txt").html()||"").replace(n,"").replace(/>([^<\.]+?\.)?[^\.<]*?[Æ’fF][RrÉ¾Ð³][EÄ“eÑ‘]+[WwÏ‰ð‘¤]+[EÑ‘Ä“e][BbÉ“][NnÉ³Î·][OÃ¸à«¦Ñ³Ïƒo][VÑµÎ½v][EÑ‘eÄ“][^<,!\?;:\"â€â€œâ€™â€˜\(\)\-\d]*/g,">$1")]}}))}))},i.prototype.searchNovels=function(a){return e(this,void 0,void 0,(function(){var e,i,l,o,u,s;return t(this,(function(t){switch(t.label){case 0:return e=Date.now(),this.lastSearch&&e-this.lastSearch<=this.searchInterval?[4,this.sleep(this.searchInterval)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,(0,r.fetchApi)(this.site+"search",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({searchkey:a}).toString()})];case 3:if(i=t.sent(),this.lastSearch=Date.now(),!i.ok)throw new Error("Could not reach site ('".concat(i.status,"') try to open in webview."));return o=n.load,[4,i.text()];case 4:if(l=o.apply(void 0,[t.sent()]),u=(null===(s=l("script").text().match(/alert\((.*?)\)/))||void 0===s?void 0:s[1])||"")throw new Error(u);return[2,this.parseNovels(l)]}}))}))},i}();exports.default=new i;