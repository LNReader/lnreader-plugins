var e=this&&this.__awaiter||function(e,a,t,l){return new(t||(t=Promise))((function(n,r){function i(e){try{u(l.next(e))}catch(e){r(e)}}function o(e){try{u(l.throw(e))}catch(e){r(e)}}function u(e){var a;e.done?n(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(i,o)}u((l=l.apply(e,a||[])).next())}))},a=this&&this.__generator||function(e,a){var t,l,n,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(u){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(r=0)),r;)try{if(t=1,l&&(n=2&o[0]?l.return:o[0]?l.throw||((n=l.return)&&n.call(l),0):l.next)&&!(n=n.call(l,o[1])).done)return n;switch(l=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,l=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(n=r.trys,(n=n.length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){r.label=o[1];break}if(6===o[0]&&r.label<n[1]){r.label=n[1],n=o;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(o);break}n[2]&&r.ops.pop(),r.trys.pop();continue}o=a.call(e,r)}catch(e){o=[6,e],l=0}finally{t=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("cheerio"),l=require("@libs/fetch"),n=require("@libs/filterInputs"),r=function(){function r(){this.id="novelbuddy",this.name="NovelBuddy.io",this.site="https://novelbuddy.io/",this.version="1.0.3",this.icon="src/en/novelbuddy/icon.png",this.filters={orderBy:{value:"views",label:"Order by",options:[{label:"Views",value:"views"},{label:"Updated At",value:"updated_at"},{label:"Created At",value:"created_at"},{label:"Name",value:"name"},{label:"Rating",value:"rating"}],type:n.FilterTypes.Picker},keyword:{value:"",label:"Keywords",type:n.FilterTypes.TextInput},status:{value:"all",label:"Status",options:[{label:"All",value:"all"},{label:"Ongoing",value:"ongoing"},{label:"Completed",value:"completed"}],type:n.FilterTypes.Picker},genre:{value:[],label:"Genres (OR, not AND)",options:[{label:"Action",value:"action"},{label:"Action Adventure",value:"action-adventure"},{label:"Adult",value:"adult"},{label:"Adventcure",value:"adventcure"},{label:"Adventure",value:"adventure"},{label:"Adventurer",value:"adventurer"},{label:"Bender",value:"bender"},{label:"Chinese",value:"chinese"},{label:"Comedy",value:"comedy"},{label:"Cultivation",value:"cultivation"},{label:"Drama",value:"drama"},{label:"Eastern",value:"eastern"},{label:"Ecchi",value:"ecchi"},{label:"Fan Fiction",value:"fan-fiction"},{label:"Fanfiction",value:"fanfiction"},{label:"Fantas",value:"fantas"},{label:"Fantasy",value:"fantasy"},{label:"Game",value:"game"},{label:"Gender",value:"gender"},{label:"Gender Bender",value:"gender-bender"},{label:"Harem",value:"harem"},{label:"HaremAction",value:"haremaction"},{label:"Haremv",value:"haremv"},{label:"Historica",value:"historica"},{label:"Historical",value:"historical"},{label:"History",value:"history"},{label:"Horror",value:"horror"},{label:"Isekai",value:"isekai"},{label:"Josei",value:"josei"},{label:"Lolicon",value:"lolicon"},{label:"Magic",value:"magic"},{label:"Martial",value:"martial"},{label:"Martial Arts",value:"martial-arts"},{label:"Mature",value:"mature"},{label:"Mecha",value:"mecha"},{label:"Military",value:"military"},{label:"Modern Life",value:"modern-life"},{label:"Mystery",value:"mystery"},{label:"Mystery Adventure",value:"mystery-adventure"},{label:"Psychologic",value:"psychologic"},{label:"Psychological",value:"psychological"},{label:"Reincarnation",value:"reincarnation"},{label:"Romance",value:"romance"},{label:"Romance Adventure",value:"romance-adventure"},{label:"Romance Harem",value:"romance-harem"},{label:"Romancem",value:"romancem"},{label:"School Life",value:"school-life"},{label:"Sci-fi",value:"sci-fi"},{label:"Seinen",value:"seinen"},{label:"Shoujo",value:"shoujo"},{label:"Shoujo Ai",value:"shoujo-ai"},{label:"Shounen",value:"shounen"},{label:"Shounen Ai",value:"shounen-ai"},{label:"Slice of Life",value:"slice-of-life"},{label:"Smut",value:"smut"},{label:"Sports",value:"sports"},{label:"Superna",value:"superna"},{label:"Supernatural",value:"supernatural"},{label:"System",value:"system"},{label:"Tragedy",value:"tragedy"},{label:"Urban",value:"urban"},{label:"Urban Life",value:"urban-life"},{label:"Wuxia",value:"wuxia"},{label:"Xianxia",value:"xianxia"},{label:"Xuanhuan",value:"xuanhuan"},{label:"Yaoi",value:"yaoi"},{label:"Yuri",value:"yuri"}],type:n.FilterTypes.CheckboxGroup}}}return r.prototype.parseNovels=function(e){var a=[];return e(".book-item").each((function(t,l){var n,r=e(l).find(".title").text(),i="https:"+e(l).find("img").attr("data-src"),o=null===(n=e(l).find(".title a").attr("href"))||void 0===n?void 0:n.substring(1);if(o){var u={name:r,cover:i,path:o};a.push(u)}})),a},r.prototype.popularNovels=function(n,r){return e(this,arguments,void 0,(function(e,n){var r,i,o,u,s=n.filters;return a(this,(function(a){switch(a.label){case 0:return(r=new URLSearchParams).append("sort",s.orderBy.value.toString()),r.append("status",s.status.value.toString()),s.genre.value instanceof Array&&s.genre.value.forEach((function(e){r.append("genre[]",e.toString())})),r.append("q",s.keyword.value.toString()),r.append("page",e.toString()),i="".concat(this.site,"search?").concat(r.toString()),[4,(0,l.fetchApi)(i)];case 1:return[4,a.sent().text()];case 2:return o=a.sent(),u=(0,t.load)(o),[2,this.parseNovels(u)]}}))}))},r.prototype.parseNovel=function(n){return e(this,void 0,void 0,(function(){var r,i,o,u,s,c,v,b=this;return a(this,(function(h){switch(h.label){case 0:return[4,(0,l.fetchApi)(this.site+n)];case 1:return[4,h.sent().text()];case 2:return r=h.sent(),i=(0,t.load)(r),o={path:n,name:i(".name h1").text().trim()||"Untitled",cover:"https:"+i(".img-cover img").attr("data-src"),summary:i(".section-body.summary .content").text().trim(),chapters:[]},i(".meta.box p").each((function(e,a){var t=i(a).find("strong").text(),l=i(a).find("a");switch(t){case"Authors :":o.author=l.find("span").map((function(e,a){return i(a).text()})).toArray().join(", ");break;case"Status :":o.status=l.text();break;case"Genres :":o.genres=l.text().trim()}})),u=i("script").text().match(/bookId = (\d+);/)[1],s=[],c=function(n){return e(b,void 0,void 0,(function(){var e,r;return a(this,(function(a){switch(a.label){case 0:return e="".concat(this.site,"api/manga/").concat(n,"/chapters?source=detail"),[4,(0,l.fetchApi)(e)];case 1:return[4,a.sent().text()];case 2:return r=a.sent(),(i=(0,t.load)(r))("li").each((function(e,a){var t,l=i(a).find(".chapter-title").text().trim(),n=i(a).find(".chapter-update").text().trim(),r=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],o=r.join("|"),u=new RegExp("(".concat(o,") (\\d{1,2}), (\\d{4})"),"i").exec(n);if(u){var c=+u[3],v=r.indexOf(u[1].toLowerCase()),b=+u[2],h=null===(t=i(a).find("a").attr("href"))||void 0===t?void 0:t.slice(1);h&&s.push({name:l,releaseTime:new Date(c,v,b).toISOString(),path:h})}})),[2,s]}}))}))},v=o,[4,c(u)];case 3:return v.chapters=h.sent().reverse(),[2,o]}}))}))},r.prototype.parseChapter=function(n){return e(this,void 0,void 0,(function(){var e,r;return a(this,(function(a){switch(a.label){case 0:return[4,(0,l.fetchApi)(this.site+n)];case 1:return[4,a.sent().text()];case 2:return e=a.sent(),(r=(0,t.load)(e))("#listen-chapter").remove(),r("#google_translate_element").remove(),[2,r(".chapter__content").html()||""]}}))}))},r.prototype.searchNovels=function(n,r){return e(this,void 0,void 0,(function(){var e,i,o;return a(this,(function(a){switch(a.label){case 0:return e="".concat(this.site,"search?q=").concat(encodeURIComponent(n),"&page=").concat(r),[4,(0,l.fetchApi)(e)];case 1:return[4,a.sent().text()];case 2:return i=a.sent(),o=(0,t.load)(i),[2,this.parseNovels(o)]}}))}))},r}();exports.default=new r;