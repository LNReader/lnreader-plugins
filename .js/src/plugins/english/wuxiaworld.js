var e=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(r,s)}l((o=o.apply(e,n||[])).next())}))},n=this&&this.__generator||function(e,n){var t,o,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=s(0),r.throw=s(1),r.return=s(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(l){return function(s){if(t)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(i=0)),i;)try{if(t=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=n.call(e,i)}catch(e){s=[6,e],o=0}finally{t=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(exports,"__esModule",{value:!0});var t,o=require("cheerio"),a=require("@libs/fetch"),i=require("@libs/novelStatus");!function(e){e[e.Finished=0]="Finished",e[e.Active=1]="Active",e[e.Hiatus=2]="Hiatus",e[e.All=-1]="All"}(t||(t={}));var r=function(){function r(){this.id="wuxiaworld",this.name="Wuxia World",this.icon="src/en/wuxiaworld/icon.png",this.site="https://www.wuxiaworld.com/",this.apiSite="https://api2.wuxiaworld.com/wuxiaworld.api.v2.",this.version="0.5.1",this.proto='\n    syntax = "proto3";\n    option optimize_for = CODE_SIZE;\n    package wuxiaworld.api.v2;\n\n    import public "google/protobuf/wrappers.proto";\n    import public "google/protobuf/timestamp.proto";\n    \n    message StringValue {\n        // The string value.\n        string value = 1;\n    }\n    \n    message BoolValue {\n        // The bool value.\n        bool value = 1;\n    }\n    \n    message Int32Value {\n        // The int32 value.\n        int32 value = 1;\n    }\n    \n    message DecimalValue {\n        // Whole units part of the amount\n        int64 units = 1;\n        // Nano units of the amount (10^-9)\n        // Must be the same sign as units\n        sfixed32 nanos = 2;\n    }\n    \n    message Timestamp {\n        int64 seconds = 1;\n        int32 nanos = 2;\n    }\n\n    message RelatedChapterUserInfo {\n        optional BoolValue isChapterUnlocked = 1;\n        optional BoolValue isNovelUnlocked = 2;\n        optional BoolValue isChapterFavorite = 3;\n        optional BoolValue isNovelOwned = 4;\n        optional BoolValue isChapterOwned = 5;\n    }\n\n    message ChapterNovelInfo {\n        int32 id = 1;\n        string name = 2;\n        optional StringValue coverUrl = 3;\n        string slug = 4;\n    }\n    \n    message ChapterParagraph {\n        string id = 1;\n        int32 chapterId = 2;\n        int32 totalComments = 3;\n        optional StringValue content = 4;\n    }\n    \n    message ChapterItem {\n        int32 entityId = 1;\n        string name = 2;\n        string slug = 3;\n        optional DecimalValue number = 4;\n        optional StringValue content = 5;\n        int32 novelId = 6;\n        bool visible = 7;\n        bool isTeaser = 8;\n        optional Timestamp whenToPublish = 9;\n        bool spoilerTitle = 10;\n        bool allowComments = 11;\n        optional ChapterNovelInfo novelInfo = 14;\n        optional RelatedChapterUserInfo relatedUserInfo = 16;\n        int32 offset = 17;\n        optional Timestamp publishedAt = 18;\n        optional StringValue translatorThoughts = 19;\n        repeated ChapterParagraph paragraphs = 21;\n    }\n    \n    message ChapterGroupCounts {\n        int32 total = 1;\n        int32 advance = 2;\n        int32 normal = 3;\n    }\n    \n    message ChapterGroupItem {\n        int32 id = 1;\n        string title = 2;\n        int32 order = 3;\n        optional DecimalValue fromChapterNumber = 4;\n        optional DecimalValue toChapterNumber = 5;\n        repeated ChapterItem chapterList = 6;\n        optional ChapterGroupCounts counts = 7;\n    }\n    \n    message GetChapterListRequest {\n        int32 novelId = 1;\n        message BaseChapterInfo {\n            oneof chapterInfo {\n                int32 chapterId = 1;\n                string slug = 2;\n                int32 offset = 3;\n            }\n        }\n        message FilterChapters {\n            optional Int32Value chapterGroupId = 1;\n            optional BoolValue isAdvanceChapter = 2;\n            optional BaseChapterInfo baseChapter = 3;\n        }\n        optional FilterChapters filter = 2;\n        optional Int32Value count = 3;\n    }\n    \n    message GetChapterListResponse {\n        repeated ChapterGroupItem items = 1;\n        optional ChapterNovelInfo novelInfo = 2;\n    }\n\n    message GetChapterByProperty {\n        message ByNovelAndChapterSlug {\n            string novelSlug = 1;\n            string chapterSlug = 2;\n        }\n        oneof byProperty {\n            int32 chapterId = 1;\n            ByNovelAndChapterSlug slugs = 2;\n        }\n    }\n    \n    message GetChapterRequest {\n        optional GetChapterByProperty chapterProperty = 1;\n    }\n    \n    message GetChapterResponse {\n        optional ChapterItem item = 1;\n    }\n\n    message NovelKarmaInfo {\n        bool isActive = 1;\n        bool isFree = 2;\n        optional DecimalValue maxFreeChapter = 3;\n        bool canUnlockWithVip = 4;\n    }\n\n    message NovelItem {\n        int32 id = 1;\n        string name = 2;\n        string slug = 3;\n        enum Status {\n            Finished = 0;\n            Active = 1;\n            Hiatus = 2;\n            All = -1;\n        }\n        Status status = 4;\n        bool visible = 7;\n        optional StringValue description = 8;\n        optional StringValue synopsis = 9;\n        optional StringValue coverUrl = 10;\n        optional StringValue translatorName = 11;\n        optional StringValue authorName = 13;\n        optional NovelKarmaInfo karmaInfo = 14;\n        repeated string genres = 16;\n    }\n\n    message GetNovelRequest {\n        oneof selector {\n            int32 id = 1;\n            string slug = 2;\n        }\n    }\n    \n    message GetNovelResponse {\n        optional NovelItem item = 1;\n    }\n\n    service Chapters {\n        rpc GetChapterList(GetChapterListRequest) returns (GetChapterListResponse);\n        rpc GetChapter(GetChapterRequest) returns (GetChapterResponse);\n    }\n\n    service Novels {\n        rpc GetNovel(GetNovelRequest) returns (GetNovelResponse);\n    }\n    '}return r.prototype.parseNovels=function(e){var n=[];return e.items.map((function(e){var t=e.name,o=e.coverUrl,a="novel/".concat(e.slug,"/");n.push({name:t,cover:o,path:a})})),n},r.prototype.popularNovels=function(){return e(this,void 0,void 0,(function(){var e,t;return n(this,(function(n){switch(n.label){case 0:return e="".concat(this.site,"api/novels"),[4,(0,a.fetchApi)(e)];case 1:return[4,n.sent().json()];case 2:return t=n.sent(),[2,this.parseNovels(t)]}}))}))},r.prototype.parseNovel=function(r){return e(this,void 0,void 0,(function(){var e,s,l,p,u,h,c,v,d,m,f,g,C,b,y,w,I,N,G,S,V,R,T;return n(this,(function(n){switch(n.label){case 0:return[4,(0,a.fetchProto)({proto:this.proto,requestType:"GetNovelRequest",responseType:"GetNovelResponse",requestData:{slug:r.split("/")[1]}},this.apiSite+"Novels/GetNovel",{headers:{"Content-Type":"application/grpc-web+proto"}})];case 1:switch(e=n.sent(),s={path:r,name:(null===(h=e.item)||void 0===h?void 0:h.name)||"Untitled",cover:null===(v=null===(c=e.item)||void 0===c?void 0:c.coverUrl)||void 0===v?void 0:v.value,summary:(0,o.load)((null===(m=null===(d=e.item)||void 0===d?void 0:d.description)||void 0===m?void 0:m.value)+"\n\n"+(null===(g=null===(f=e.item)||void 0===f?void 0:f.synopsis)||void 0===g?void 0:g.value)).text(),author:null===(b=null===(C=e.item)||void 0===C?void 0:C.authorName)||void 0===b?void 0:b.value,genres:null===(y=e.item)||void 0===y?void 0:y.genres.join(","),chapters:[]},null===(w=e.item)||void 0===w?void 0:w.status){case t.Active:s.status=i.NovelStatus.Ongoing;break;case t.Hiatus:s.status=i.NovelStatus.OnHiatus;break;case t.All:s.status=i.NovelStatus.Unknown;break;default:s.status=i.NovelStatus.Completed}return[4,(0,a.fetchProto)({proto:this.proto,requestType:"GetChapterListRequest",responseType:"GetChapterListResponse",requestData:{novelId:null===(I=e.item)||void 0===I?void 0:I.id}},this.apiSite+"Chapters/GetChapterList",{headers:{"Content-Type":"application/grpc-web+proto"}})];case 2:return l=n.sent(),p=Number(null===(S=null===(G=null===(N=e.item)||void 0===N?void 0:N.karmaInfo)||void 0===G?void 0:G.maxFreeChapter)||void 0===S?void 0:S.units)+((null===(T=null===(R=null===(V=e.item)||void 0===V?void 0:V.karmaInfo)||void 0===R?void 0:R.maxFreeChapter)||void 0===T?void 0:T.nanos)||0)/1e9||50,u=l.items.flatMap((function(e){return e.chapterList.map((function(n){var t,o,a,i,s,l;return{page:e.title,name:n.name+(!1===(null===(o=null===(t=n.relatedUserInfo)||void 0===t?void 0:t.isChapterUnlocked)||void 0===o?void 0:o.value)||!n.relatedUserInfo&&Number(null===(a=n.number)||void 0===a?void 0:a.units)+((null===(i=n.number)||void 0===i?void 0:i.nanos)||0)/1e9>p?" ðŸ”’":""),path:r+n.slug,chapterNumber:n.offset,releaseTime:new Date(1e3*((null===(s=n.publishedAt)||void 0===s?void 0:s.seconds)||0)+((null===(l=n.publishedAt)||void 0===l?void 0:l.nanos)||0)/1e6).toISOString()}}))})),s.chapters=u,[2,s]}}))}))},r.prototype.parseChapter=function(t){return e(this,void 0,void 0,(function(){var e,o,i,r;return n(this,(function(n){switch(n.label){case 0:return e=t.split("/"),[4,(0,a.fetchProto)({proto:this.proto,requestType:"GetChapterRequest",responseType:"GetChapterResponse",requestData:{chapterProperty:{slugs:{novelSlug:e[1],chapterSlug:e[2]}}}},this.apiSite+"Chapters/GetChapter",{headers:{"Content-Type":"application/grpc-web+proto"}})];case 1:return o=n.sent(),[2,(null===(r=null===(i=o.item)||void 0===i?void 0:i.content)||void 0===r?void 0:r.value)||""]}}))}))},r.prototype.searchNovels=function(t){return e(this,void 0,void 0,(function(){var e,o;return n(this,(function(n){switch(n.label){case 0:return e=this.site+"api/novels/search?query="+encodeURIComponent(t),[4,(0,a.fetchApi)(e)];case 1:return[4,n.sent().json()];case 2:return o=n.sent(),[2,this.parseNovels(o)]}}))}))},r}();exports.default=new r;