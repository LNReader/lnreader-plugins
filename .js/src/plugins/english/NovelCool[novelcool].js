var e=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,a){function i(e){try{p(n.next(e))}catch(e){a(e)}}function s(e){try{p(n.throw(e))}catch(e){a(e)}}function p(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,s)}p((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var o,n,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(p){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(o=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,p])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("@libs/fetch"),r=require("@libs/novelStatus"),a=require("@libs/filterInputs"),i=o(require("dayjs")),s=new(function(){function o(e){var t,o=this;this.resolveUrl=function(e,t){return o.site+(t?"/novel/":"/chapter/")+e.split("?id=")[0]},this.id=e.id,this.name=e.sourceName,this.site=e.sourceSite,this.icon="multisrc/novelcool/novelcool/icon.png",this.mainUrl="https://api.novelcool.com",this.version="1.0.0",this.options=null!==(t=e.options)&&void 0!==t?t:{},this.filters={sortby:{label:"Order by",value:"hot",options:[{label:"Hottest",value:"hot"},{label:"Latest",value:"latest"},{label:"New Books",value:"new_book"}],type:a.FilterTypes.Picker}}}return o.prototype.popularNovels=function(o,r){return e(this,arguments,void 0,(function(e,o){var r,a,i,s,p=o.filters,c=o.showLatestNovels;return t(this,(function(t){switch(t.label){case 0:return r=c?"latest":(null===(s=null==p?void 0:p.sortby)||void 0===s?void 0:s.value)||"hot",[4,(0,n.fetchApi)(this.mainUrl+"/elite/"+r,{headers:{"User-Agent":this.options.app.userAgent,"Content-Type":"application/x-www-form-urlencoded"},method:"post",body:new URLSearchParams({appId:this.options.app.appId,secret:this.options.app.secret,package_name:this.options.app.package_name,lc_type:"novel",lang:this.options.langCode,page:e.toString(),page_size:"20"}).toString()}).then((function(e){return e.json()}))];case 1:return a=t.sent().list,i=[],a.forEach((function(e){return i.push({name:e.name,cover:e.cover,path:e.visit_path+"?id="+e.id})})),[2,i]}}))}))},o.prototype.parseNovel=function(o){return e(this,void 0,void 0,(function(){var e,a,s,p;return t(this,(function(t){switch(t.label){case 0:return e=o.split("?id=")[1],[4,(0,n.fetchApi)(this.mainUrl+"/book/info/",{headers:{"User-Agent":this.options.app.userAgent,"Content-Type":"application/x-www-form-urlencoded"},method:"post",body:new URLSearchParams({book_id:e,appId:this.options.app.appId,secret:this.options.app.secret,package_name:this.options.app.package_name,lang:this.options.langCode}).toString()}).then((function(e){return e.json()}))];case 1:return a=t.sent().info,s={path:o,name:a.name,cover:a.cover,genres:a.category_list.join(","),summary:a.intro,author:a.author,artist:a.artist,status:"YES"===a.completed?r.NovelStatus.Completed:r.NovelStatus.Ongoing,rating:a.rate_star&&parseFloat(a.rate_star)||void 0},p=[],[4,(0,n.fetchApi)(this.mainUrl+"/chapter/book_list/",{headers:{"User-Agent":this.options.app.userAgent,"Content-Type":"application/x-www-form-urlencoded"},method:"post",body:new URLSearchParams({book_id:e,appId:this.options.app.appId,secret:this.options.app.secret,package_name:this.options.app.package_name,lang:this.options.langCode}).toString()}).then((function(e){return e.json()}))];case 2:return t.sent().list.forEach((function(e){e.is_locked||p.push({name:e.title,path:e.book_id+"/"+e.id,releaseTime:(0,i.default)(1e3*parseInt(e.last_modify,10)).format("LLL"),chapterNumber:parseInt(e.order_id,10)})})),s.chapters=p.reverse(),[2,s]}}))}))},o.prototype.parseChapter=function(o){return e(this,void 0,void 0,(function(){var e,r;return t(this,(function(t){switch(t.label){case 0:return e=o.split("/"),r=e[1],[4,(0,n.fetchApi)(this.mainUrl+"/chapter/info/",{headers:{"User-Agent":this.options.app.userAgent,"Content-Type":"application/x-www-form-urlencoded"},method:"post",body:new URLSearchParams({chapter_id:r,appId:this.options.app.appId,secret:this.options.app.secret,package_name:this.options.app.package_name,lang:this.options.langCode}).toString()}).then((function(e){return e.json()}))];case 1:return[2,t.sent().info.content]}}))}))},o.prototype.searchNovels=function(o,r){return e(this,void 0,void 0,(function(){var e,a;return t(this,(function(t){switch(t.label){case 0:return[4,(0,n.fetchApi)(this.mainUrl+"/book/search/",{headers:{"User-Agent":this.options.app.userAgent,"Content-Type":"application/x-www-form-urlencoded"},method:"post",body:new URLSearchParams({appId:this.options.app.appId,secret:this.options.app.secret,package_name:this.options.app.package_name,keyword:o,lc_type:"novel",lang:this.options.langCode,page:r.toString(),page_size:"20"}).toString()}).then((function(e){return e.json()}))];case 1:return e=t.sent().list,a=[],e.forEach((function(e){return a.push({name:e.name,cover:e.cover,path:e.visit_path+"?id="+e.id})})),[2,a]}}))}))},o}())({id:"novelcool",sourceName:"NovelCool",sourceSite:"https://www.novelcool.com",options:{lang:"English",langCode:"en",app:{userAgent:"Android/Package:com.zuoyou.novel - Version Name:2.3 - Phone Info:sdk_gphone_x86_64(Android Version:13)",package_name:"com.zuoyou.novel",appId:"202201290625004",secret:"c73a8590641781f203660afca1d37ada"}}});exports.default=s;