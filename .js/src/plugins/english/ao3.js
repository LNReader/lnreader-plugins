var e=this&&this.__awaiter||function(e,a,l,t){return new(l||(l=Promise))((function(r,n){function o(e){try{i(t.next(e))}catch(e){n(e)}}function u(e){try{i(t.throw(e))}catch(e){n(e)}}function i(e){var a;e.done?r(e.value):(a=e.value,a instanceof l?a:new l((function(e){e(a)}))).then(o,u)}i((t=t.apply(e,a||[])).next())}))},a=this&&this.__generator||function(e,a){var l,t,r,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=u(0),o.throw=u(1),o.return=u(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(i){return function(u){if(l)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(n=0)),n;)try{if(l=1,t&&(r=2&u[0]?t.return:u[0]?t.throw||((r=t.return)&&r.call(t),0):t.next)&&!(r=r.call(t,u[1])).done)return r;switch(t=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,t=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(!(r=n.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){n=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){n.label=u[1];break}if(6===u[0]&&n.label<r[1]){n.label=r[1],r=u;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(u);break}r[2]&&n.ops.pop(),n.trys.pop();continue}u=a.call(e,n)}catch(e){u=[6,e],t=0}finally{l=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,i])}}};Object.defineProperty(exports,"__esModule",{value:!0});var l=require("cheerio"),t=require("@libs/fetch"),r=require("@libs/filterInputs"),n=require("@libs/defaultCover"),o=function(){function o(){this.id="archiveofourown",this.name="Archive Of Our Own",this.version="1.0.3",this.icon="src/en/ao3/icon.png",this.site="https://archiveofourown.org/",this.filters={sort:{value:"hits",label:"Sort by",options:[{label:"Best Match",value:"_score"},{label:"Hits",value:"hits"},{label:"Kudos",value:"kudos"},{label:"Comments",value:"comments"},{label:"Bookmarks",value:"bookmarks"},{label:"Word Count",value:"word_count"},{label:"Date Updated",value:"revised_at"},{label:"Date Posted",value:"created_at"},{label:"Author",value:"authors_to_sort_on"},{label:"Title",value:"title_to_sort_on"}],type:r.FilterTypes.Picker},sortdir:{value:"desc",label:"Sort direction",options:[{label:"Descending",value:"desc"},{label:"Ascending",value:"asc"}],type:r.FilterTypes.Picker},ratings:{value:"",label:"Ratings",options:[{label:"Not Rated",value:"9"},{label:"General Audiences",value:"10"},{label:"Teen And Up Audiences",value:"11"},{label:"Mature",value:"12"},{label:"Explicit",value:"13"}],type:r.FilterTypes.Picker},language:{value:"en",label:"Language",options:[{label:"None",value:""},{label:"af Soomaali",value:"so"},{label:"Afrikaans",value:"afr"},{label:"Aynu itak | ã‚¢ã‚¤ãƒŒ ã‚¤ã‚¿ã‡°",value:"ain"},{label:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",value:"ar"},{label:"áŠ áˆ›áˆ­áŠ›",value:"amh"},{label:"ð“‚‹ð“ºð“ˆ– ð“†Žð“…“ð“ð“Š–",value:"egy"},{label:"ÜÜªÜ¡ÜÜ | ××¨×ž×™×",value:"arc"},{label:"Õ°Õ¡ÕµÕ¥Ö€Õ¥Õ¶",value:"hy"},{label:"American Sign Language",value:"ase"},{label:"asturianu",value:"ast"},{label:"Bahasa Indonesia",value:"id"},{label:"Bahasa Malaysia",value:"ms"},{label:"Ð‘ÑŠÐ»Ð³Ð°Ñ€ÑÐºÐ¸",value:"bg"},{label:"à¦¬à¦¾à¦‚à¦²à¦¾",value:"bn"},{label:"Basa Jawa",value:"jv"},{label:"Ð‘Ð°ÑˆÒ¡Ð¾Ñ€Ñ‚ Ñ‚ÐµÐ»Ðµ",value:"ba"},{label:"Ð±ÐµÐ»Ð°Ñ€ÑƒÑÐºÐ°Ñ",value:"be"},{label:"Bosanski",value:"bos"},{label:"Brezhoneg",value:"br"},{label:"CatalÃ ",value:"ca"},{label:"Cebuano",value:"ceb"},{label:"ÄŒeÅ¡tina",value:"cs"},{label:"Chinuk Wawa",value:"chn"},{label:"ÐºÑŠÑ‹Ñ€Ñ‹Ð¼Ñ‚Ð°Ñ‚Ð°Ñ€ Ñ‚Ð¸Ð»Ð¸ | qÄ±rÄ±mtatar tili",value:"crh"},{label:"Cymraeg",value:"cy"},{label:"Dansk",value:"da"},{label:"Deutsch",value:"de"},{label:"eesti keel",value:"et"},{label:"Î•Î»Î»Î·Î½Î¹ÎºÎ¬",value:"el"},{label:"ð’…´ð’‚ ",value:"sux"},{label:"English",value:"en"},{label:"Eald EnglisÄ‹",value:"ang"},{label:"EspaÃ±ol",value:"es"},{label:"Esperanto",value:"eo"},{label:"Euskara",value:"eu"},{label:"ÙØ§Ø±Ø³ÛŒ",value:"fa"},{label:"Filipino",value:"fil"},{label:"FranÃ§ais",value:"fr"},{label:"Friisk",value:"frr"},{label:"Furlan",value:"fur"},{label:"Gaeilge",value:"ga"},{label:"GÃ idhlig",value:"gd"},{label:"Galego",value:"gl"},{label:"ðŒ²ðŒ¿ð„ðŒ¹ðƒðŒºðŒ°",value:"got"},{label:"Creolese",value:"gyn"},{label:"ä¸­æ–‡-å®¢å®¶è¯",value:"hak"},{label:"í•œêµ­ì–´",value:"ko"},{label:"Hausa | Ù‡ÙŽØ±Ù’Ø´ÙŽÙ† Ù‡ÙŽÙˆÙ’Ø³ÙŽ",value:"hau"},{label:"à¤¹à¤¿à¤¨à¥à¤¦à¥€",value:"hi"},{label:"Hrvatski",value:"hr"},{label:"Ê»ÅŒlelo HawaiÊ»i",value:"haw"},{label:"Interlingua",value:"ia"},{label:"isiZulu",value:"zu"},{label:"Ãslenska",value:"is"},{label:"Italiano",value:"it"},{label:"×¢×‘×¨×™×ª",value:"he"},{label:"Kalaallisut",value:"kal"},{label:"à²•à²¨à³à²¨à²¡",value:"kan"},{label:"áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜",value:"kat"},{label:"Kernewek",value:"cor"},{label:"áž—áž¶ážŸáž¶ážáŸ’áž˜áŸ‚ážš",value:"khm"},{label:"Khuzdul",value:"qkz"},{label:"Kiswahili",value:"sw"},{label:"kreyÃ²l ayisyen",value:"ht"},{label:"KurdÃ® | Ú©ÙˆØ±Ø¯ÛŒ",value:"ku"},{label:"ÐšÑ‹Ñ€Ð³Ñ‹Ð·Ñ‡Ð°",value:"kir"},{label:"Langue des signes quÃ©bÃ©coise",value:"fcs"},{label:"LatvieÅ¡u valoda",value:"lv"},{label:"LÃ«tzebuergesch",value:"lb"},{label:"LietuviÅ³ kalba",value:"lt"},{label:"Lingua latina",value:"la"},{label:"Magyar",value:"hu"},{label:"Ð¼Ð°ÐºÐµÐ´Ð¾Ð½ÑÐºÐ¸",value:"mk"},{label:"à´®à´²à´¯à´¾à´³à´‚",value:"ml"},{label:"Malti",value:"mt"},{label:"á ®á  á ¨á µá¡  á¡¤á¡³á °á¡ á ¨",value:"mnc"},{label:"Mando'a",value:"qmd"},{label:"à¤®à¤°à¤¾à¤ à¥€",value:"mr"},{label:"MikisÃºkÃ®",value:"mik"},{label:"á ®á £á ©á ­á £á ¯ á ªá ¢á ´á ¢á ­á Œ | ÐœÐ¾Ð½Ð³Ð¾Ð» ÐšÐ¸Ñ€Ð¸Ð»Ð» Ò¯ÑÑÐ³",value:"mon"},{label:"á€™á€¼á€”á€ºá€™á€¬á€˜á€¬á€žá€¬",value:"my"},{label:"Ð­Ñ€Ð·ÑÐ½ÑŒ ÐºÐµÐ»ÑŒ",value:"myv"},{label:"NÄhuatl",value:"nah"},{label:"ä¸­æ–‡-é—½å—è¯ è‡ºèªž",value:"nan"},{label:"Nawat",value:"ppl"},{label:"Nederlands",value:"nl"},{label:"æ—¥æœ¬èªž",value:"ja"},{label:"Norsk",value:"no"},{label:"ÐÐ·Ó™Ñ€Ð±Ð°Ñ˜Ò¹Ð°Ð½ Ð´Ð¸Ð»Ð¸ | Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† Ø¯ÛŒÙ„ÛŒ",value:"azj"},{label:"ÐÐ¾Ñ…Ñ‡Ð¸Ð¹Ð½ Ð¼Ð¾Ñ‚Ñ‚",value:"ce"},{label:"â€˜Oâ€™odham Ã‘iok",value:"ood"},{label:"Ù„Ø³Ø§Ù† Ø¹Ø«Ù…Ø§Ù†Ù‰",value:"ota"},{label:"Ù¾ÚšØªÙˆ",value:"ps"},{label:"PlattdÃ¼Ã¼tsch",value:"nds"},{label:"Polski",value:"pl"},{label:"PortuguÃªs brasileiro",value:"ptBR"},{label:"PortuguÃªs europeu",value:"ptPT"},{label:"à¨ªà©°à¨œà¨¾à¨¬à©€",value:"pa"},{label:"qazaqÅŸa | Ò›Ð°Ð·Ð°Ò›ÑˆÐ°",value:"kaz"},{label:"Uncategorized Constructed Languages",value:"qlq"},{label:"Quenya",value:"qya"},{label:"RomÃ¢nÄƒ",value:"ro"},{label:"Ð ÑƒÑÑÐºÐ¸Ð¹",value:"ru"},{label:"Scots",value:"sco"},{label:"Shqip",value:"sq"},{label:"Sindarin",value:"sjn"},{label:"à·ƒà·’à¶‚à·„à¶½",value:"si"},{label:"SlovenÄina",value:"sk"},{label:"SlovenÅ¡Äina",value:"slv"},{label:"SprÄ“kÅ ÃžiudiskÅ",value:"gem"},{label:"Ð¡Ñ€Ð¿ÑÐºÐ¸",value:"sr"},{label:"suomi",value:"fi"},{label:"Svenska",value:"sv"},{label:"à®¤à®®à®¿à®´à¯",value:"ta"},{label:"Ñ‚Ð°Ñ‚Ð°Ñ€ Ñ‚ÐµÐ»Ðµ",value:"tat"},{label:"te reo MÄori",value:"mri"},{label:"à°¤à±†à°²à±à°—à±",value:"tel"},{label:"à¹„à¸—à¸¢",value:"th"},{label:"Thermian",value:"tqx"},{label:"à½–à½¼à½‘à¼‹à½¦à¾à½‘à¼‹",value:"bod"},{label:"Tiáº¿ng Viá»‡t",value:"vi"},{label:"Ï¯â²™â²‰â²§â²£â²‰â²™â²›Ì€â²­â²â²™â²“",value:"cop"},{label:"tlhIngan-Hol",value:"tlh"},{label:"toki pona",value:"tok"},{label:"Trinidadian Creole",value:"trf"},{label:"Ï„ÏƒÎ±ÎºÏŽÎ½Î¹ÎºÎ±",value:"tsd"},{label:"á£áŽ³áŽ© áŽ¦á¬á‚áŽ¯áá—",value:"chr"},{label:"TÃ¼rkÃ§e",value:"tr"},{label:"Ð£ÐºÑ€Ð°Ñ—Ð½ÑÑŒÐºÐ°",value:"uk"},{label:"Ø§ÙØ±Ø¯ÙÙˆ",value:"urd"},{label:"Ø¦Û‡ÙŠØºÛ‡Ø± ØªÙ‰Ù„Ù‰",value:"uig"},{label:"VolapÃ¼k",value:"vol"},{label:"ä¸­æ–‡-å´è¯­",value:"wuu"},{label:"×™×™×“×™×©",value:"yi"},{label:"maayaÊ¼ tÊ¼Ã an",value:"yua"},{label:"ä¸­æ–‡-å¹¿ä¸œè¯ ç²µèªž",value:"yue"},{label:"ä¸­æ–‡-æ™®é€šè¯ åœ‹èªž",value:"zh"}],type:r.FilterTypes.Picker},completion:{value:"",label:"Completion Status",options:[{label:"All works",value:"checked"},{label:"Complete works only",value:"T"},{label:"Works in progress only",value:"F"}],type:r.FilterTypes.Picker},crossover:{value:"",label:"Crossover Status",options:[{label:"Include crossovers",value:"checked"},{label:"Exclude crossovers",value:"T"},{label:"Only crossovers",value:"F"}],type:r.FilterTypes.Picker},categories:{value:[],label:"Categories",options:[{label:"F/F",value:"116"},{label:"F/M",value:"22"},{label:"Gen",value:"21"},{label:"M/M",value:"23"},{label:"Multi",value:"2246"},{label:"Other",value:"24"}],type:r.FilterTypes.CheckboxGroup},warningsFilter:{value:[],label:"Warnings",options:[{label:"Creator Chose Not To Use Archive Warnings",value:"14"},{label:"Graphic Depictions Of Violence",value:"17"},{label:"Major Character Death",value:"18"},{label:"No Archive Warnings Apply",value:"16"},{label:"Rape/Non-Con",value:"19"},{label:"Underage",value:"20"}],type:r.FilterTypes.CheckboxGroup},singlechap:{value:"",label:"Single Chapter Stories",options:[{label:"Single Chapter",value:"1"}],type:r.FilterTypes.Picker},author:{value:"",label:"Author/Artist",type:r.FilterTypes.TextInput},dateFilter:{value:"",label:"Enter single Number only Date",type:r.FilterTypes.TextInput},dateIncrements:{value:"days+ago",label:"Must choose date type",options:[{label:"Days",value:"days+ago"},{label:"Weeks",value:"weeks+ago"},{label:"Months",value:"months+ago"},{label:"Years",value:"years+ago"}],type:r.FilterTypes.Picker},words:{value:"",label:"Word Count, exact number eg. 40 or  less than eg. <40 or greater than eg. >40 or range eg. 10-100",type:r.FilterTypes.TextInput},hits:{value:"",label:"Hits",type:r.FilterTypes.TextInput},bookmarks:{value:"",label:"Bookmarks",type:r.FilterTypes.TextInput},comments:{value:"",label:"Comments",type:r.FilterTypes.TextInput},kudos:{value:"",label:"Kudos",type:r.FilterTypes.TextInput}}}return o.prototype.parseNovels=function(e){var a=[];return e("li.work").each((function(l,t){var r,o=e(t).find("h4.heading > a").first().text().trim(),u=null===(r=e(t).find("h4.heading > a").first().attr("href"))||void 0===r?void 0:r.trim();if(u){var i={name:o,cover:n.defaultCover,path:u.slice(1)};a.push(i)}})),a},o.prototype.popularNovels=function(r,n){return e(this,arguments,void 0,(function(e,r){var n,o,u,i=r.showLatestNovels,s=r.filters;return a(this,(function(a){switch(a.label){case 0:return n="".concat(this.site,"works/search?page=").concat(e,"&work_search%5Blanguage_id%5D=en"),i?n+="&work_search%5Bsort_column%5D=revised_at&work_search%5Bsort_direction%5D=".concat(s.sortdir.value):s&&(n+="&work_search%5Bsort_column%5D=".concat(s.sort.value,"&work_search%5Bsort_direction%5D=").concat(s.sortdir.value)),s&&(""!==s.completion.value&&(n+="&work_search%5Bcomplete%5D=".concat(s.completion.value)),""!==s.crossover.value&&(n+="&work_search%5Bcrossover%5D=".concat(s.crossover.value)),s.categories.value.length>0&&s.categories.value.forEach((function(e){n+="&work_search%5Bcategory_ids%5D%5B%5D=".concat(e)})),s.warningsFilter.value.length>0&&s.warningsFilter.value.forEach((function(e){n+="&work_search%5Barchive_warning_ids%5D%5B%5D=".concat(e)})),""!==s.singlechap.value&&(n+="&work_search%5Bsingle_chapter%5D=".concat(s.singlechap.value)),""!==s.author.value&&(n+="&work_search%5Bcreators%5D=".concat(s.author.value)),""!==s.dateFilter.value&&""!==s.dateIncrements.value&&(n+="&work_search%5Brevised_at%5D=".concat(s.dateFilter.value,"+").concat(s.dateIncrements.value)),""!==s.words.value&&(n+="&work_search%5Bword_count%5D=".concat(s.words.value)),""!==s.hits.value&&(n+="&work_search%5Bhits%5D=".concat(s.hits.value)),""!==s.bookmarks.value&&(n+="&work_search%5Bbookmarks_count%5D=".concat(s.bookmarks.value)),""!==s.comments.value&&(n+="&work_search%5Bcomments_count%5D=".concat(s.comments.value)),""!==s.kudos.value&&(n+="&work_search%5Bkudos_count%5D=".concat(s.kudos.value))),[4,(0,t.fetchApi)(n).then((function(e){return e.text()}))];case 1:return o=a.sent(),u=(0,l.load)(o),[2,this.parseNovels(u)]}}))}))},o.prototype.parseNovel=function(r){return e(this,void 0,void 0,(function(){var e,o,u,i,s,c,v,b,h,p,d,m,f,g,k,y,w,_,x,T,F;return a(this,(function(a){switch(a.label){case 0:return[4,(0,t.fetchApi)(new URL(r,this.site).toString())];case 1:return e=a.sent(),o=r+"/navigate",[4,(0,t.fetchApi)(new URL(o,this.site).toString())];case 2:return u=a.sent(),[4,e.text()];case 3:return i=a.sent(),[4,u.text()];case 4:return s=a.sent(),c=(0,l.load)(s),v=(0,l.load)(i),(b={path:r,name:v("h2.title").text().trim()||"Untitled",cover:n.defaultCover,status:v("dt.status").text().includes("Updated")?"Ongoing":"Completed",chapters:[]}).author=v('a[rel="author"]').map((function(e,a){return v(a).text().trim()})).get().join(", "),b.genres=Array.from(v("dd.freeform.tags li a.tag")).map((function(e){return v(e).text().trim()})).join(","),h=v("blockquote.userstuff").text().trim(),p=Array.from(v("dd.fandom.tags li a.tag")).map((function(e){return v(e).text().trim()})).join(","),d=Array.from(v("dd.rating.tags li a.tag")).map((function(e){return v(e).text().trim()})).join(","),m=Array.from(v("dd.warning.tags li a.tag")).map((function(e){return v(e).text().trim()})).join(","),f=Array.from(v("dd.series li a.tag")).map((function(e){return v(e).text().trim()})).join(","),g=Array.from(v("dd.relationship.tags li a.tag")).map((function(e){return v(e).text().trim()})).join(","),k=Array.from(v("dd.character.tags li a.tag")).map((function(e){return v(e).text().trim()})).join(","),y=Array.from(v("dd.stats li a.tag")).map((function(e){return v(e).text().trim()})).join(","),b.summary="Fandom:\n".concat(p,"\n\nRating:\n").concat(d,"\n\nWarning:\n").concat(m,"\n\nSummary:\n").concat(h,"\n\nSeries:\n").concat(f,"\n\nRelationships:\n").concat(g,"\n\nCharacters:\n").concat(k,"\n\nStats:\n").concat(y),w=[],_=[],c("ol.index").each((function(e,a){c(a).find("li").each((function(e,a){c(a).find("a").text().trim();var l=c(a).find("span.datetime").text().replace(/\(([^)]+)\)/g,"$1").trim(),t=l?new Date(l).toISOString():"";_.push(t)}))})),x=v(".wrapper dd.published").text().trim(),T=x?new Date(x).toISOString():"",F=0,v("#chapter_index select").length>0&&v("#chapter_index select").each((function(e,a){v(a).find("option").each((function(e,a){var l,t=v(a).text().trim(),n=null===(l=v(a).attr("value"))||void 0===l?void 0:l.trim(),o="".concat(r,"/chapters/").concat(n),u=_[F];F++,o&&w.push({name:t,path:o,releaseTime:u})}))})),0===w.length&&(v("#chapters h3.title").each((function(e,a){var l,t,n=v(a).text().trim().match(/:\s*(.*)$/),o=n?n[1].trim():"",u=null===(l=v(a).find("a").attr("href"))||void 0===l?void 0:l.trim(),i=null===(t=null==u?void 0:u.match(/\/chapters\/(\d+)/))||void 0===t?void 0:t[1],s="".concat(r,"/chapters/").concat(i);if(s){if(""===o)o=v(".work .title.heading").text().trim();w.push({name:o,path:s,releaseTime:T})}})),0===w.length&&v(".work.navigation.actions li a").each((function(e,a){var l=v(a).attr("href");if(l&&l.includes("/downloads/")){var t=l.match(/updated_at=(\d+)/),n=t?t[1]:null,o=v("h2.title.heading").text().trim(),u="".concat(r,"/chapters/").concat(n);if(u){if(""===o)o=v(".work .title.heading").text().trim();w.push({name:o,path:u,releaseTime:T})}}}))),b.chapters=w,[2,b]}}))}))},o.prototype.parseChapter=function(r){return e(this,void 0,void 0,(function(){var e,n;return a(this,(function(a){switch(a.label){case 0:return[4,(0,t.fetchApi)(new URL(r,this.site).toString())];case 1:return[4,a.sent().text()];case 2:return e=a.sent(),(n=(0,l.load)(e))("h3.title").each((function(e,a){var l=n(a),t=l.find("a");t.removeAttr("href");var r=t.text().trim(),o=l.contents().filter((function(e,a){return 3===a.nodeType})).text().trim();l.html("".concat(r,"<br>").concat(o))})),n("h3.landmark.heading#work").remove(),[2,n("div#chapters > div").html()||""]}}))}))},o.prototype.searchNovels=function(r,n){return e(this,void 0,void 0,(function(){var e,o,u;return a(this,(function(a){switch(a.label){case 0:return e="".concat(this.site,"works/search?page=").concat(n,"&work_search%5Blanguage_id%5D=en&work_search%5Bquery%5D=").concat(encodeURIComponent(r)),[4,(0,t.fetchApi)(e)];case 1:return[4,a.sent().text()];case 2:return o=a.sent(),u=(0,l.load)(o),[2,this.parseNovels(u)]}}))}))},o}();exports.default=new o;