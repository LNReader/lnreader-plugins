var e=this&&this.__awaiter||function(e,a,t,r){return new(t||(t=Promise))((function(l,n){function i(e){try{u(r.next(e))}catch(e){n(e)}}function o(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var a;e.done?l(e.value):(a=e.value,a instanceof t?a:new t((function(e){e(a)}))).then(i,o)}u((r=r.apply(e,a||[])).next())}))},a=this&&this.__generator||function(e,a){var t,r,l,n={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=o(0),i.throw=o(1),i.return=o(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(o){return function(u){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,o[0]&&(n=0)),n;)try{if(t=1,r&&(l=2&o[0]?r.return:o[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,o[1])).done)return l;switch(r=0,l&&(o=[2&o[0],l.value]),o[0]){case 0:case 1:l=o;break;case 4:return n.label++,{value:o[1],done:!1};case 5:n.label++,r=o[1],o=[0];continue;case 7:o=n.ops.pop(),n.trys.pop();continue;default:if(!(l=n.trys,(l=l.length>0&&l[l.length-1])||6!==o[0]&&2!==o[0])){n=0;continue}if(3===o[0]&&(!l||o[1]>l[0]&&o[1]<l[3])){n.label=o[1];break}if(6===o[0]&&n.label<l[1]){n.label=l[1],l=o;break}if(l&&n.label<l[2]){n.label=l[2],n.ops.push(o);break}l[2]&&n.ops.pop(),n.trys.pop();continue}o=a.call(e,n)}catch(e){o=[6,e],r=0}finally{t=l=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var t,r=require("htmlparser2"),l=require("@libs/fetch"),n=require("@libs/filterInputs"),i=function(){function i(){this.id="pawread",this.name="PawRead",this.version="2.1.0",this.icon="src/en/pawread/icon.png",this.site="https://m.pawread.com/",this.filters={status:{value:"",label:"Status",options:[{label:"All",value:""},{label:"Completed",value:"wanjie"},{label:"Ongoing",value:"lianzai"},{label:"Hiatus",value:"hiatus"}],type:n.FilterTypes.Picker},lang:{value:"",label:"Languages",options:[{label:"All",value:""},{label:"Chinese",value:"chinese"},{label:"Korean",value:"korean"},{label:"Japanese",value:"japanese"}],type:n.FilterTypes.Picker},genre:{value:"",label:"Genres",options:[{label:"All",value:""},{label:"Fantasy",value:"Fantasy"},{label:"Action",value:"Action"},{label:"Xuanhuan",value:"Xuanhuan"},{label:"Romance",value:"Romance"},{label:"Comedy",value:"Comedy"},{label:"Mystery",value:"Mystery"},{label:"Mature",value:"Mature"},{label:"Harem",value:"Harem"},{label:"Wuxia",value:"Wuxia"},{label:"Xianxia",value:"Xianxia"},{label:"Tragedy",value:"Tragedy"},{label:"Sci-fi",value:"Scifi"},{label:"Historical",value:"Historical"},{label:"Ecchi",value:"Ecchi"},{label:"Adventure",value:"Adventure"},{label:"Adult",value:"Adult"},{label:"Supernatural",value:"Supernatural"},{label:"Psychological",value:"Psychological"},{label:"Drama",value:"Drama"},{label:"Horror",value:"Horror"},{label:"Josei",value:"Josei"},{label:"Mecha",value:"Mecha"},{label:"Seinen",value:"Seinen"},{label:"Shoujo",value:"Shoujo"},{label:"Shounen",value:"Shounen"},{label:"Smut",value:"Smut"},{label:"Yaoi",value:"Yaoi"},{label:"Yuri",value:"Yuri"},{label:"Martial Arts",value:"MartialArts"},{label:"School Life",value:"SchoolLife"},{label:"Shoujo Ai",value:"ShoujoAi"},{label:"Shounen Ai",value:"ShounenAi"},{label:"Slice of Life",value:"SliceofLife"},{label:"Gender Bender",value:"GenderBender"},{label:"Sports",value:"Sports"},{label:"Urban",value:"Urban"},{label:"Adventurer",value:"Adventurer"}],type:n.FilterTypes.Picker},sort:{value:"click",label:"Sort By",options:[{label:"Time Updated",value:"update"},{label:"Time Posted",value:"post"},{label:"Clicks",value:"click"}],type:n.FilterTypes.Picker},order:{value:!1,label:"Order ↑ ↓",type:n.FilterTypes.Switch}}}return i.prototype.parseNovels=function(e){var a=[],l={},n=t.Idle,i=new r.Parser({onopentag:function(e,a){if(a.class&&(a.class.includes("list-comic")||a.class.includes("itemBox"))&&(n=t.Novel),n===t.Novel)switch(e){case"a":"txtA"!==a.class&&"title"!==a.class||(l.path=a.href.split("/").slice(1,3).join("/"),n=t.NovelName);break;case"img":l.cover=a.src}},ontext:function(e){n===t.NovelName&&(l.name=(l.name||"")+e)},onclosetag:function(e){"a"===e&&l.name&&l.cover&&(a.push(l),l={},n=t.Idle)}});return i.write(e),i.end(),a},i.prototype.popularNovels=function(t,r){return e(this,arguments,void 0,(function(e,t){var r,n,i,o=t.filters;return a(this,(function(a){switch(a.label){case 0:return r="".concat(this.site,"list/"),(n=[o.genre.value,o.status.value,o.lang.value].filter((function(e){return""!==e}))).length>0&&(r+=n.join("-")+"/"),r+=(o.order.value?"-":"")+o.sort.value,r+="/?page=".concat(e),[4,(0,l.fetchApi)(r).then((function(e){return e.text()}))];case 1:return i=a.sent(),[2,this.parseNovels(i)]}}))}))},i.prototype.parseNovel=function(n){return e(this,void 0,void 0,(function(){var e,i,o,u,s,c,p,h,v,b;return a(this,(function(a){switch(a.label){case 0:return e=n.endsWith("/")?"":"/",[4,(0,l.fetchApi)(this.site+n+e)];case 1:return[4,a.sent().text()];case 2:return i=a.sent(),o={path:n},u=0,s=t.Idle,c={},p=[],h=[],v=[],b=new r.Parser({onopentag:function(a,r){var l,i;switch(a){case"div":if("Cover"===r.id&&(s=t.Cover),null===(l=r.class)||void 0===l?void 0:l.includes("item-box")){s=t.Chapter;var p=r.onclick.match(/\d+/)[0];return void(c.path="".concat(n).concat(e).concat(p,".html"))}s===t.Chapter&&u++;break;case"img":s===t.Cover&&(o.name=r.title,o.cover=r.src);break;case"p":"txtItme"===r.class?o.status?o.author||(s=t.Author):s=t.Status:"full-des"===r.id&&(s=t.Summary);break;case"br":h.push("\n");break;case"a":(null===(i=r.class)||void 0===i?void 0:i.includes("btn-default"))&&(s=t.Genres);break;case"span":s===t.Chapter&&u++,2===u?s=t.ChapterName:1===u&&(s=t.ChapterTime)}},ontext:function(e){switch(s){case t.Status:o.status=(o.status||"")+e.trim();break;case t.Author:o.author=(o.author||"")+e.trim();break;case t.Genres:v.push(e.trim());break;case t.Summary:h.push(e);break;case t.ChapterName:c.name=(c.name||"")+e.trim();break;case t.ChapterTime:if(null==e?void 0:e.includes("Advanced"))return;var a=e.split(".").map((function(e){return Number(e)}));3===a.length&&(c.releaseTime=new Date(a[0],a[1]-1,a[2]).toISOString())}},onclosetag:function(e){switch(e){case"div":s===t.Cover&&(s=t.Idle),s===t.Chapter&&--u<0&&(c.path&&c.name&&c.releaseTime&&p.push(c),c={},u=0,s=t.Idle);break;case"p":s!==t.Status&&s!==t.Author&&s!==t.Summary||(s=t.Idle);break;case"a":s===t.Genres&&(s=t.Idle);break;case"span":s!==t.ChapterName&&s!==t.ChapterTime||(s=t.Chapter,u--)}},onend:function(){o.genres=v.join(", "),o.summary=h.join(""),o.chapters=p}}),b.write(i),b.end(),[2,o]}}))}))},i.prototype.parseChapter=function(n){return e(this,void 0,void 0,(function(){var e,i,o,u,s,c,p,h;return a(this,(function(a){switch(a.label){case 0:return[4,(0,l.fetchApi)(this.site+n).then((function(e){return e.text()}))];case 1:return e=a.sent(),i=0,o=t.Idle,u=[],s=/[&<>"' ]/g,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"," ":"&nbsp;"},p=function(e){return e.replace(s,(function(e){return c[e]}))},(h=new r.Parser({onopentag:function(e,a){switch(o){case t.Idle:"div"===e&&"main"===a.class&&(o=t.Chapter,i++);break;case t.Chapter:"div"===e&&i++;break;default:return}if(o===t.Chapter){var r=Object.keys(a).map((function(e){var t=a[e].replace(/"/g,"&quot;");return" ".concat(e,'="').concat(t,'"')}));u.push("<".concat(e).concat(r.join(""),">"))}},ontext:function(e){if(o===t.Chapter){var a=p(e);["pawread","tinyurl","bit.ly"].some((function(e){return null==a?void 0:a.includes(e)}))?(o=t.Hidden,u.pop()):u.push(a)}},onclosetag:function(e){switch(o){case t.Chapter:h.isVoidElement(e)||u.push("</".concat(e,">")),"div"===e&&i--,0===i&&(o=t.Stopped);break;case t.Hidden:o=t.Chapter}}})).write(e),h.end(),[2,u.join("")]}}))}))},i.prototype.searchNovels=function(t,r){return e(this,void 0,void 0,(function(){var e,n;return a(this,(function(a){switch(a.label){case 0:return e=new URLSearchParams({keywords:t,page:r.toString()}),[4,(0,l.fetchApi)("".concat(this.site,"search/?").concat(e.toString()))];case 1:return[4,a.sent().text()];case 2:return n=a.sent(),[2,this.parseNovels(n)]}}))}))},i}();exports.default=new i,function(e){e[e.Idle=0]="Idle",e[e.Cover=1]="Cover",e[e.Genres=2]="Genres",e[e.Author=3]="Author",e[e.Status=4]="Status",e[e.Hidden=5]="Hidden",e[e.Summary=6]="Summary",e[e.Stopped=7]="Stopped",e[e.Chapter=8]="Chapter",e[e.ChapterName=9]="ChapterName",e[e.ChapterTime=10]="ChapterTime",e[e.NovelName=11]="NovelName",e[e.Novel=12]="Novel"}(t||(t={}));