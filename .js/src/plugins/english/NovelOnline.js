var e=this&&this.__awaiter||function(e,t,a,l){return new(a||(a=Promise))((function(n,r){function o(e){try{u(l.next(e))}catch(e){r(e)}}function i(e){try{u(l.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}u((l=l.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,l,n,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(u){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(r=0)),r;)try{if(a=1,l&&(n=2&i[0]?l.return:i[0]?l.throw||((n=l.return)&&n.call(l),0):l.next)&&!(n=n.call(l,i[1])).done)return n;switch(l=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,l=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!(n=r.trys,(n=n.length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){r=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){r.label=i[1];break}if(6===i[0]&&r.label<n[1]){r.label=n[1],n=i;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(i);break}n[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],l=0}finally{a=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("cheerio"),l=require("@libs/fetch"),n=require("@libs/filterInputs"),r=function(){function r(){this.id="NO.net",this.name="novelsOnline",this.site="https://novelsonline.org",this.icon="src/en/novelsonline/icon.png",this.version="1.0.1",this.filters={keyword:{value:"",label:"Keyword",type:n.FilterTypes.TextInput},novel_type:{value:[],label:"Novel Type",options:[{label:"Web Novel",value:"Web Novel"},{label:"Light Novel",value:"Light Novel"},{label:"Chinese Novel",value:"Chinese Novel"},{label:"Korean Novel",value:"Korean Novel"}],type:n.FilterTypes.CheckboxGroup},language:{value:[],label:"Language",options:[{label:"Chinese",value:"Chinese"},{label:"Japanese",value:"Japanese"},{label:"Korean",value:"Korean"}],type:n.FilterTypes.CheckboxGroup},genre:{value:[],label:"Genre",options:[{label:"Action",value:"4"},{label:"Adventure",value:"1"},{label:"Celebrity",value:"39"},{label:"Comedy",value:"12"},{label:"Drama",value:"6"},{label:"Ecchi",value:"47"},{label:"Fantasy",value:"2"},{label:"Gender Bender",value:"14"},{label:"Harem",value:"45"},{label:"Historical",value:"22"},{label:"Horror",value:"31"},{label:"Josei",value:"21"},{label:"Martial Arts",value:"18"},{label:"Mature",value:"46"},{label:"Mecha",value:"30"},{label:"Mystery",value:"7"},{label:"Psychological",value:"8"},{label:"Romance",value:"9"},{label:"School Life",value:"10"},{label:"Sci-fi",value:"3"},{label:"Seinen",value:"23"},{label:"Shotacon",value:"35"},{label:"Shoujo",value:"11"},{label:"Shoujo Ai",value:"34"},{label:"Shounen",value:"5"},{label:"Shounen Ai",value:"32"},{label:"Slice of Life",value:"13"},{label:"Sports",value:"33"},{label:"Supernatural",value:"25"},{label:"Tragedy",value:"24"},{label:"Wuxia",value:"17"},{label:"Xianxia",value:"20"},{label:"Xuanhuan",value:"38"},{label:"Yaoi",value:"16"},{label:"Yuri",value:"27"}],type:n.FilterTypes.CheckboxGroup},completed:{value:"",label:"Completed",options:[{label:"Any",value:""},{label:"Yes",value:"yes"},{label:"No",value:"no"}],type:n.FilterTypes.Picker}}}return r.prototype.safeFetch=function(n){return e(this,arguments,void 0,(function(e,n){var r,o,i;return void 0===n&&(n=void 0),t(this,(function(t){switch(t.label){case 0:return[4,(0,l.fetchApi)(e,n)];case 1:if(!(r=t.sent()).ok)throw new Error("Could not reach site ("+r.status+") try to open in webview.");return[4,r.text()];case 2:if(o=t.sent(),i=(0,a.load)(o),!(void 0!==i("title")))throw new Error("Captcha protection detected (Input is random characters). Please try opening the page in WebView.");return[2,i]}}))}))},r.prototype.parseNovels=function(a){return e(this,void 0,void 0,(function(){var e,l=this;return t(this,(function(t){return e=[],a(".top-novel-block").each((function(t,n){var r=a(n).find("h2").text(),o=a(n).find(".top-novel-cover img").attr("src"),i=a(n).find("h2 a").attr("href");i&&e.push({name:r,cover:o,path:i.replace(l.site,"")})})),[2,e]}))}))},r.prototype.popularNovels=function(a,l){return e(this,arguments,void 0,(function(e,a){var l,n,r,o,i,u,s=a.filters;return t(this,(function(t){switch(t.label){case 0:for(n in l=new URLSearchParams,s)if("keyword"===n)l.append("keyword",s[n].value);else if("object"==typeof s[n].value)for(r=0,o=s[n].value;r<o.length;r++)i=o[r],l.append("include[".concat(n,"][]"),i);else s[n].value&&l.append("include[".concat(n,"][]"),s[n].value);return l.toString()?(l.append("search","1"),[2,1==e?this.detailedSearch(l):[]]):[4,this.safeFetch(this.site+"/top-novel/"+e)];case 1:return u=t.sent(),[2,this.parseNovels(u)]}}))}))},r.prototype.searchNovels=function(a){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){return(e=new URLSearchParams).append("keyword",a),e.append("search","1"),[2,this.detailedSearch(e)]}))}))},r.prototype.detailedSearch=function(a){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,this.safeFetch(this.site+"/detailed-search",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()})];case 1:return e=t.sent(),[2,this.parseNovels(e)]}}))}))},r.prototype.parseNovel=function(a){return e(this,void 0,void 0,(function(){var e,l,n=this;return t(this,(function(t){switch(t.label){case 0:return[4,this.safeFetch(this.site+a)];case 1:return e=t.sent(),l={path:a,name:e("h1").text()||"Untitled",cover:e(".novel-cover").find("a > img").attr("src"),chapters:[]},e(".novel-detail-item").each((function(t,a){var n=e(a).find("h6").text(),r=e(a).find(".novel-detail-body");switch(n){case"Description":l.summary=r.text();break;case"Genre":l.genres=r.find("li").map((function(t,a){return e(a).text()})).get().join(", ");break;case"Author(s)":l.author=r.find("li").map((function(t,a){return e(a).text()})).get().join(", ");break;case"Artist(s)":var o=r.find("li").map((function(t,a){return e(a).text()})).get().join(", ");o&&"N/A"!=o&&(l.artist=o);break;case"Status":l.status=r.text().trim()}})),l.chapters=e("ul.chapter-chs > li > a").map((function(t,a){var l=e(a).attr("href");return{name:e(a).text(),path:null==l?void 0:l.replace(n.site,"")}})).get(),[2,l]}}))}))},r.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,this.safeFetch(this.site+a)];case 1:return e=t.sent(),[2,e("#contentall").html()||""]}}))}))},r}();exports.default=new r;