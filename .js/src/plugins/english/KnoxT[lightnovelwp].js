var e=this&&this.__awaiter||function(e,a,l,t){return new(l||(l=Promise))((function(i,o){function r(e){try{n(t.next(e))}catch(e){o(e)}}function s(e){try{n(t.throw(e))}catch(e){o(e)}}function n(e){var a;e.done?i(e.value):(a=e.value,a instanceof l?a:new l((function(e){e(a)}))).then(r,s)}n((t=t.apply(e,a||[])).next())}))},a=this&&this.__generator||function(e,a){var l,t,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=s(0),r.throw=s(1),r.return=s(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(n){return function(s){if(l)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(o=0)),o;)try{if(l=1,t&&(i=2&s[0]?t.return:s[0]?t.throw||((i=t.return)&&i.call(t),0):t.next)&&!(i=i.call(t,s[1])).done)return i;switch(t=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,t=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=a.call(e,o)}catch(e){s=[6,e],t=0}finally{l=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,n])}}};Object.defineProperty(exports,"__esModule",{value:!0});var l=require("cheerio"),t=require("htmlparser2"),i=require("@libs/fetch"),o=require("@libs/novelStatus"),r=require("@libs/defaultCover"),s=require("@libs/storage");function n(e,a){var l=e.match(/(\d+)$/);l&&l[0]&&(a.chapterNumber=parseInt(l[0]))}var u=new(function(){function u(e){var a,l,t;this.hideLocked=s.storage.get("hideLocked"),this.id=e.id,this.name=e.sourceName,this.icon="multisrc/lightnovelwp/".concat(e.id.toLowerCase(),"/icon.png"),this.site=e.sourceSite;var i=(null===(a=e.options)||void 0===a?void 0:a.versionIncrements)||0;this.version="1.1.".concat(7+i),this.options=null!==(l=e.options)&&void 0!==l?l:{},this.filters=e.filters,(null===(t=this.options)||void 0===t?void 0:t.hasLocked)&&(this.pluginSettings={hideLocked:{value:"",label:"Hide locked chapters",type:"Switch"}})}return u.prototype.getHostname=function(e){var a=(e=e.split("/")[2]).split(".");return a.pop(),a.join(".")},u.prototype.safeFecth=function(l,t){return e(this,void 0,void 0,(function(){var e,o,r,s,n,u,v,c;return a(this,(function(a){switch(a.label){case 0:return e=l.split("://"),o=e.shift(),r=e[0].replace(/\/\//g,"/"),[4,(0,i.fetchApi)(o+"://"+r)];case 1:if(!(s=a.sent()).ok&&1!=t)throw new Error("Could not reach site ("+s.status+") try to open in webview.");return[4,s.text()];case 2:if(n=a.sent(),u=null===(c=null===(v=n.match(/<title>(.*?)<\/title>/))||void 0===v?void 0:v[1])||void 0===c?void 0:c.trim(),this.getHostname(l)!=this.getHostname(s.url)||u&&("Bot Verification"==u||"You are being redirected..."==u||"Un instant..."==u||"Just a moment..."==u||"Redirecting..."==u))throw new Error("Captcha error, please open in webview (or the website has changed url)");return[2,n]}}))}))},u.prototype.parseNovels=function(e){var a=this;e=(0,l.load)(e).html();var t=[];return(e.match(/<article([^]*?)<\/article>/g)||[]).forEach((function(e){var l=e.match(/<a href="([^\"]*)".*? title="([^\"]*)"/)||[],i=l[1],o=l[2];if(o&&i){var s=e.match(/<img [^>]*?src="([^\"]*)"[^>]*?(?: data-src="([^\"]*)")?[^>]*>/)||[],n=void 0;if(i.includes(a.site))n=i.replace(a.site,"");else{var u=i.split("/");u.shift(),u.shift(),u.shift(),n=u.join("/")}t.push({name:o,cover:s[2]||s[1]||r.defaultCover,path:n})}})),t},u.prototype.popularNovels=function(l,t){return e(this,arguments,void 0,(function(e,l){var t,i,o,r,s,n,u,v,c,b=l.filters,h=l.showLatestNovels;return a(this,(function(a){switch(a.label){case 0:for(o in t=null!==(c=null===(v=this.options)||void 0===v?void 0:v.seriesPath)&&void 0!==c?c:"/series/",i=this.site+t+"?page="+e,b||(b=this.filters||{}),h&&(i+="&order=latest"),b)if("object"==typeof b[o].value)for(r=0,s=b[o].value;r<s.length;r++)n=s[r],i+="&".concat(o,"=").concat(n);else b[o].value&&(i+="&".concat(o,"=").concat(b[o].value));return[4,this.safeFecth(i,!1)];case 1:return u=a.sent(),[2,this.parseNovels(u)]}}))}))},u.prototype.parseNovel=function(l){return e(this,void 0,void 0,(function(){var e,i,s,u,v,c,b,h,d,p,g,m,f,y,w,C,k,S,L,P,N;return a(this,(function(a){switch(a.label){case 0:return e=this.site,[4,this.safeFecth(e+l,!1)];case 1:return i=a.sent(),s={path:l,name:"",genres:"",summary:"",author:"",artist:"",status:"",chapters:[]},u=!1,v=!1,c=0,b=!1,h=!1,d=!1,p=!1,g=!1,m=!1,f=!1,y=0,w=!1,C=!1,k=[],S={},L=this.hideLocked,P=new t.Parser({onopentag:function(a,l){var t;!s.cover&&(null===(t=l.class)||void 0===t?void 0:t.includes("ts-post-image"))?(s.name=l.title,s.cover=l["data-src"]||l.src||r.defaultCover):"genxed"===l.class||"sertogenre"===l.class?u=!0:u&&"a"===a?v=!0:"div"!==a||"entry-content"!==l.class&&"description"!==l.itemprop?"spe"===l.class||"serl"===l.class?b=!0:b&&"span"===a?h=!0:"div"===a&&"sertostat"===l.class?(b=!0,h=!0,g=!0):l.class&&l.class.includes("eplister")?m=!0:m&&"li"===a?f=!0:f?"a"===a&&void 0===S.path?S.path=l.href.replace(e,"").trim():"epl-num"===l.class?y=1:"epl-title"===l.class?y=2:"epl-date"===l.class?y=3:"epl-price"===l.class&&(y=4):c&&"div"===a&&c++:c++},ontext:function(e){var a,l;if(u)v&&(s.genres+=e+", ");else if(1===c)s.summary+=e.trim();else if(b){if(h){var t=e.toLowerCase().replace(":","").trim();if(d)s.author+=e||"Unknown";else if(p)s.artist+=e||"Unknown";else if(g)switch(t){case"مكتملة":case"completed":case"complété":case"completo":case"completado":case"tamamlandı":s.status=o.NovelStatus.Completed;break;case"مستمرة":case"ongoing":case"en cours":case"em andamento":case"en progreso":case"devam ediyor":s.status=o.NovelStatus.Ongoing;break;case"متوقفة":case"hiatus":case"en pause":case"hiato":case"pausa":case"pausado":case"duraklatıldı":s.status=o.NovelStatus.OnHiatus;break;default:s.status=o.NovelStatus.Unknown}switch(t){case"الكاتب":case"author":case"auteur":case"autor":case"yazar":d=!0;break;case"الحالة":case"status":case"statut":case"estado":case"durum":g=!0;break;case"الفنان":case"artist":case"artiste":case"artista":case"çizer":p=!0}}}else if(m&&f)if(1===y)e.includes("🔒")?(w=!0,C=!0):C&&(w=!1),n(e,S);else if(2===y)S.name=(null===(l=null===(a=e.match(RegExp("^".concat(s.name.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"\\s*(.+)"))))||void 0===a?void 0:a[1])||void 0===l?void 0:l.trim())||e.trim(),S.chapterNumber||n(e,S);else if(3===y)S.releaseTime=e;else if(4===y){switch(t=e.toLowerCase().trim()){case"free":case"gratuit":case"مجاني":case"livre":case"":w=!1;break;default:w=!0}}},onclosetag:function(e){var a,l,t;u?v?v=!1:(u=!1,s.genres=null===(a=s.genres)||void 0===a?void 0:a.slice(0,-2)):c?"br"===e?s.summary+="\n":"div"===e&&c--:b?h?"span"===e&&(h=!1,d&&s.author?d=!1:p&&s.artist?p=!1:g&&""!==s.status&&(g=!1)):"div"===e&&(b=!1,s.author=null===(l=s.author)||void 0===l?void 0:l.trim(),s.artist=null===(t=s.artist)||void 0===t?void 0:t.trim()):m&&(f?1===y||2===y||3===y||4===y?y=0:"li"===e&&(f=!1,S.chapterNumber||(S.chapterNumber=0),w&&(S.name="🔒 "+S.name),L&&w||k.push(S),S={}):"ul"===e&&(m=!1))}}),P.write(i),P.end(),k.length&&((null===(N=this.options)||void 0===N?void 0:N.reverseChapters)&&k.reverse(),s.chapters=k),[2,s]}}))}))},u.prototype.parseChapter=function(t){return e(this,void 0,void 0,(function(){var e,i,o,r,s;return a(this,(function(a){switch(a.label){case 0:return[4,this.safeFecth(this.site+t,!1)];case 1:if(e=a.sent(),null===(o=this.options)||void 0===o?void 0:o.customJs)try{i=(0,l.load)(e),e=i.html()}catch(e){throw console.error("Error executing customJs:",e),e}return[2,(null===(s=null===(r=e.match(/<div.*?class="epcontent ([^]*?)<div.*?class="?bottomnav/g))||void 0===r?void 0:r[0].match(/<p[^>]*>([^]*?)<\/p>/g))||void 0===s?void 0:s.join("\n"))||""]}}))}))},u.prototype.searchNovels=function(l,t){return e(this,void 0,void 0,(function(){var e,i;return a(this,(function(a){switch(a.label){case 0:return e=this.site+"page/"+t+"/?s="+encodeURIComponent(l),[4,this.safeFecth(e,!0)];case 1:return i=a.sent(),[2,this.parseNovels(i)]}}))}))},u}())({id:"knoxt",sourceSite:"https://knoxt.space/",sourceName:"KnoxT",options:{lang:"English",reverseChapters:!0},filters:{"genre[]":{type:"Checkbox",label:"Genre",value:[],options:[{label:"1v1",value:"1v1"},{label:"ABO",value:"abo"},{label:"Absent Parents",value:"absent-parents"},{label:"Action",value:"action"},{label:"Adult",value:"adult"},{label:"Adults",value:"adults"},{label:"Adventure",value:"adventure"},{label:"Adventurers",value:"adventurers"},{label:"Age gap",value:"age-gap"},{label:"Age Regression",value:"age-regression"},{label:"Aggressive Characters",value:"aggressive-characters"},{label:"Amnesia",value:"amnesia"},{label:"Ancient times",value:"ancient-times"},{label:"Anti-social Protagonist",value:"anti-social-protagonist"},{label:"Appearance Changes",value:"appearance-changes"},{label:"Arranged Marriage",value:"arranged-marriage"},{label:"Artificial Intelligence",value:"artificial-intelligence"},{label:"Artists",value:"artists"},{label:"Beautiful bottom",value:"beautiful-bottom"},{label:"Betrayal",value:"betrayal"},{label:"Bickering Couple",value:"bickering-couple"},{label:"BL",value:"bl"},{label:"BL (Boys' Love)",value:"bl-boys-love"},{label:"Blind Dates",value:"blind-dates"},{label:"Blind Protagonist",value:"blind-protagonist"},{label:"Boys love",value:"boys-love"},{label:"Business Management",value:"business-management"},{label:"Businessmen",value:"businessmen"},{label:"Calm Protagonist",value:"calm-protagonist"},{label:"Campus",value:"campus"},{label:"carefree protagonist",value:"carefree-protagonist"},{label:"Caring Protagonist",value:"caring-protagonist"},{label:"celebrity",value:"celebrity"},{label:"CEO",value:"ceo"},{label:"Character Growth",value:"character-growth"},{label:"Charming Protagonist",value:"charming-protagonist"},{label:"Child Abuse",value:"child-abuse"},{label:"Childcare",value:"childcare"},{label:"Childhood Friends",value:"childhood-friends"},{label:"Childhood Love",value:"childhood-love"},{label:"Childish Protagonist",value:"childish-protagonist"},{label:"Chinese novel",value:"chinese-novel"},{label:"Clever Protagonist",value:"clever-protagonist"},{label:"Clingy Lover",value:"clingy-lover"},{label:"Clumsy Love Interests",value:"clumsy-love-interests"},{label:"Cohabitation",value:"cohabitation"},{label:"Cold Love Interests",value:"cold-love-interests"},{label:"Cold Protagonist",value:"cold-protagonist"},{label:"comedic undertone",value:"comedic-undertone"},{label:"Comedy",value:"comedy"},{label:"Complex Family Relationships",value:"complex-family-relationships"},{label:"Confident Protagonist",value:"confident-protagonist"},{label:"Conflicting Loyalties",value:"conflicting-loyalties"},{label:"Cooking",value:"cooking"},{label:"Couple Growth",value:"couple-growth"},{label:"Crime",value:"crime"},{label:"Cross-dressing",value:"cross-dressing"},{label:"Cryostasis",value:"cryostasis"},{label:"Cute Children",value:"cute-children"},{label:"Cute Protagonist",value:"cute-protagonist"},{label:"Cute Story",value:"cute-story"},{label:"Determined Protagonist",value:"determined-protagonist"},{label:"Devoted Love Interests",value:"devoted-love-interests"},{label:"Different Social Status",value:"different-social-status"},{label:"Divorce",value:"divorce"},{label:"Doctors",value:"doctors"},{label:"Doting love interest",value:"doting-love-interest"},{label:"Doting Love Interests",value:"doting-love-interests"},{label:"Doting Parents",value:"doting-parents"},{label:"Double AA",value:"double-aa"},{label:"Drama",value:"drama"},{label:"Dystopia",value:"dystopia"},{label:"empowerment fiction",value:"empowerment-fiction"},{label:"Enemies Become Lovers",value:"enemies-become-lovers"},{label:"Entertaiment circle",value:"entertaiment-circle"},{label:"Entertainment circle",value:"entertainment-circle"},{label:"Evolution",value:"evolution"},{label:"Family Conflict",value:"family-conflict"},{label:"Fantasy",value:"fantasy"},{label:"Fated Lovers",value:"fated-lovers"},{label:"Fiction",value:"fiction"},{label:"Fictional",value:"fictional"},{label:"First Love",value:"first-love"},{label:"futuristic setting",value:"futuristic-setting"},{label:"Gaming",value:"gaming"},{label:"Gender Bender",value:"gender-bender"},{label:"General",value:"general"},{label:"Genetic Modifications",value:"genetic-modifications"},{label:"GL",value:"gl"},{label:"Gore",value:"gore"},{label:"Handsome Male Lead",value:"handsome-male-lead"},{label:"Hard-Working Protagonist",value:"hard-working-protagonist"},{label:"Harem",value:"harem"},{label:"HE",value:"he"},{label:"Heartwarming",value:"heartwarming"},{label:"Hiding True Abilities",value:"hiding-true-abilities"},{label:"Hiding True Identity",value:"hiding-true-identity"},{label:"historic love",value:"historic-love"},{label:"Historical",value:"historical"},{label:"Horror",value:"horror"},{label:"Human-Nonhuman Relationship",value:"human-nonhuman-relationship"},{label:"humor",value:"humor"},{label:"Idol",value:"idol"},{label:"Inferiority Complex",value:"inferiority-complex"},{label:"infrastructure",value:"infrastructure"},{label:"interstellar",value:"interstellar"},{label:"Isekai",value:"isekai"},{label:"Jealousy",value:"jealousy"},{label:"Josei",value:"josei"},{label:"Kind love interest",value:"kind-love-interest"},{label:"Kind Love Interests",value:"kind-love-interests"},{label:"Lawyers",value:"lawyers"},{label:"lighthearted drama",value:"lighthearted-drama"},{label:"Loner Protagonist",value:"loner-protagonist"},{label:"Long Separations",value:"long-separations"},{label:"Love Affair",value:"love-affair"},{label:"Love and hate",value:"love-and-hate"},{label:"love at first sight",value:"love-at-first-sight"},{label:"Love Interest Falls in Love First",value:"love-interest-falls-in-love-first"},{label:"love romance",value:"love-romance"},{label:"Lovers Reunited",value:"lovers-reunited"},{label:"Male protagonist",value:"male-protagonist"},{label:"Male Yandere",value:"male-yandere"},{label:"Manipulative Characters",value:"manipulative-characters"},{label:"Manly Gay Couple",value:"manly-gay-couple"},{label:"Marriage",value:"marriage"},{label:"Marriage of Convenience",value:"marriage-of-convenience"},{label:"Martial Arts",value:"martial-arts"},{label:"Mary Sue",value:"mary-sue"},{label:"Mature",value:"mature"},{label:"Mecha",value:"mecha"},{label:"Medical Knowledge",value:"medical-knowledge"},{label:"Modern",value:"modern"},{label:"Modern day",value:"modern-day"},{label:"Mpreg",value:"mpreg"},{label:"Multiple Reincarnated Individuals",value:"multiple-reincarnated-individuals"},{label:"Multiple worlds",value:"multiple-worlds"},{label:"Mute Character",value:"mute-character"},{label:"mutual salvation",value:"mutual-salvation"},{label:"Mystery",value:"mystery"},{label:"Mystery Solving",value:"mystery-solving"},{label:"Naive Protagonist",value:"naive-protagonist"},{label:"Near-Death Experience",value:"near-death-experience"},{label:"Obsessive Love",value:"obsessive-love"},{label:"Older Love Interests",value:"older-love-interests"},{label:"Omegaverse",value:"omegaverse"},{label:"Orphans",value:"orphans"},{label:"Otherworld fantasy",value:"otherworld-fantasy"},{label:"Overpowered protagonist",value:"overpowered-protagonist"},{label:"Past Plays a Big Role",value:"past-plays-a-big-role"},{label:"Past Trauma",value:"past-trauma"},{label:"Persistent Love Interests",value:"persistent-love-interests"},{label:"Poor Protagonist",value:"poor-protagonist"},{label:"Possessive Characters",value:"possessive-characters"},{label:"post apocalypse",value:"post-apocalypse"},{label:"Post-apocalyptic",value:"post-apocalyptic"},{label:"Post-apocalyptic background",value:"post-apocalyptic-background"},{label:"Power Couple",value:"power-couple"},{label:"Pretend Lovers",value:"pretend-lovers"},{label:"Professional",value:"professional"},{label:"Prosecutor",value:"prosecutor"},{label:"Protagonist Falls in Love First",value:"protagonist-falls-in-love-first"},{label:"Protagonist Strong from the Start",value:"protagonist-strong-from-the-start"},{label:"Psychological",value:"psychological"},{label:"Quick transmigration",value:"quick-transmigration"},{label:"REBIRTH",value:"rebirth"},{label:"Redemption",value:"redemption"},{label:"Regression",value:"regression"},{label:"Reincarnation",value:"reincarnation"},{label:"reunion",value:"reunion"},{label:"Reverse Harem",value:"reverse-harem"},{label:"Romance",value:"romance"},{label:"S*x Friends",value:"sx-friends"},{label:"School Life",value:"school-life"},{label:"Sci-fi",value:"sci-fi"},{label:"sci-fi elements",value:"sci-fi-elements"},{label:"science fiction",value:"science-fiction"},{label:"Second Chance",value:"second-chance"},{label:"Secret Crush",value:"secret-crush"},{label:"Secret Identity",value:"secret-identity"},{label:"Secret Relationship",value:"secret-relationship"},{label:"Seinen",value:"seinen"},{label:"shonen ai",value:"shonen-ai"},{label:"Short Story",value:"short-story"},{label:"Shoujo",value:"shoujo"},{label:"Shoujo ai",value:"shoujo-ai"},{label:"Shounen",value:"shounen"},{label:"Shounen ai",value:"shounen-ai"},{label:"Showbi",value:"showbi"},{label:"showbiz",value:"showbiz"},{label:"Slice of Life",value:"slice-of-life"},{label:"Smut",value:"smut"},{label:"soul-swapping",value:"soul-swapping"},{label:"Sports",value:"sports"},{label:"Stoic Characters",value:"stoic-characters"},{label:"Straight Seme",value:"straight-seme"},{label:"Straight uke",value:"straight-uke"},{label:"Straight- Gay",value:"straight-gay"},{label:"Stubborn Protagonist",value:"stubborn-protagonist"},{label:"Sugar daddy",value:"sugar-daddy"},{label:"Supernatural",value:"supernatural"},{label:"suspense",value:"suspense"},{label:"System Administrator",value:"system-administrator"},{label:"Thriller",value:"thriller"},{label:"Time Skip",value:"time-skip"},{label:"Tragedy",value:"tragedy"},{label:"Tragic Past",value:"tragic-past"},{label:"Transmigration",value:"transmigration"},{label:"Transplanted Memories",value:"transplanted-memories"},{label:"Tsundere",value:"tsundere"},{label:"Unconditional Love",value:"unconditional-love"},{label:"Unlimited flow",value:"unlimited-flow"},{label:"Unrequited Love",value:"unrequited-love"},{label:"Urban Life",value:"urban-life"},{label:"weak to strong",value:"weak-to-strong"},{label:"wealthy characters",value:"wealthy-characters"},{label:"Western",value:"western"},{label:"work",value:"work"},{label:"workplace",value:"workplace"},{label:"Wu xia",value:"wu-xia"},{label:"Wuxia",value:"wuxia"},{label:"Xianxia",value:"xianxia"},{label:"Xuanhuan",value:"xuanhuan"},{label:"Yaoi",value:"yaoi"},{label:"Younger love interest",value:"younger-love-interest"},{label:"Younger Love Interests",value:"younger-love-interests"},{label:"Yuri",value:"yuri"}]},"type[]":{type:"Checkbox",label:"Type",value:[],options:[{label:"chinese",value:"chinese"},{label:"Chinese Novel",value:"chinese-novel"},{label:"Cthulhu",value:"cthulhu"},{label:"Double AA",value:"double-aa"},{label:"historic love",value:"historic-love"},{label:"Japanese Novel",value:"japanese-novel"},{label:"Kō Randō (藍銅 紅)",value:"ko-rando-藍銅-紅"},{label:"Korean Novel",value:"korean-novel"},{label:"Light Novel (CN)",value:"light-novel-cn"},{label:"Light Novel (JP)",value:"light-novel-jp"},{label:"Original Novel",value:"original-novel"},{label:"Published Novel",value:"published-novel"},{label:"Published Novel (KR)",value:"published-novel-kr"},{label:"Quick Transmigration",value:"quick-transmigration"},{label:"Remove term: Chinese Novel Chinese NovelRemove term: Web Novel Web Novel",value:"remove-term-chinese-novel-chinese-novelremove-term-web-novel-web-novel"},{label:"romance",value:"romance"},{label:"Short Story",value:"short-story"},{label:"Web Novel",value:"web-novel"}]},status:{type:"Picker",label:"Status",value:"",options:[{label:"All",value:""},{label:"Ongoing",value:"ongoing"},{label:"Hiatus",value:"hiatus"},{label:"Completed",value:"completed"}]},order:{type:"Picker",label:"Order by",value:"",options:[{label:"Default",value:""},{label:"A-Z",value:"title"},{label:"Z-A",value:"titlereverse"},{label:"Latest Update",value:"update"},{label:"Latest Added",value:"latest"},{label:"Popular",value:"popular"}]}}});exports.default=u;