var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function i(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}c((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,n,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=i(0),o.throw=i(1),o.return=i(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(s=0)),s;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(a=s.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("cheerio"),n=require("@libs/fetch"),a=require("@libs/defaultCover"),s=require("@libs/novelStatus"),o=function(){function o(){this.id="kdtnovels",this.name="KDT Novels",this.version="1.0.0",this.icon="src/en/kdtnovels/icon.png",this.site="https://kdtnovels.com/"}return o.prototype.parseNovelItems=function(e){var t=this,n=(0,r.load)(e),s=[];return n("div.c-tabs-item__content").each((function(e,r){var o=n(r),i=o.find("div.tab-thumb img").first(),c=i.attr("data-src")||i.attr("src")||a.defaultCover,u=o.find("div.post-title > h3 > a").first(),l=u.text().trim(),h=u.attr("href");if(l&&h){var p=h.replace(t.site,"").replace(/^\/+|\/+$/g,"");s.push({name:l,path:p,cover:c||a.defaultCover})}})),s},o.prototype.parseNovelStatus=function(e){if(!e)return s.NovelStatus.Unknown;var t=e.toLowerCase().trim();return t.includes("ongoing")||t.includes("on going")?s.NovelStatus.Ongoing:t.includes("completed")||t.includes("complete")?s.NovelStatus.Completed:t.includes("licensed")?s.NovelStatus.Licensed:t.includes("finished")||t.includes("publishing finished")?s.NovelStatus.PublishingFinished:t.includes("cancelled")||t.includes("canceled")?s.NovelStatus.Cancelled:t.includes("hiatus")||t.includes("on hiatus")?s.NovelStatus.OnHiatus:e||s.NovelStatus.Unknown},o.prototype.popularNovels=function(r,a){return e(this,void 0,void 0,(function(){var e,s,o,i;return t(this,(function(t){switch(t.label){case 0:e=a.showLatestNovels?"latest":"views",s="".concat(this.site,"/page/").concat(r,"/?s&post_type=wp-manga&m_orderby=").concat(e),t.label=1;case 1:return t.trys.push([1,4,,5]),[4,(0,n.fetchApi)(s)];case 2:return[4,t.sent().text()];case 3:return o=t.sent(),[2,this.parseNovelItems(o)];case 4:return i=t.sent(),console.error("Error fetching popular novels:",i),[2,[]];case 5:return[2]}}))}))},o.prototype.searchNovels=function(r,a){return e(this,void 0,void 0,(function(){var e,s,o,i;return t(this,(function(t){switch(t.label){case 0:e="".concat(this.site,"/page/").concat(a,"/?s=").concat(encodeURIComponent(r),"&post_type=wp-manga&op&author&artist&release&adult"),t.label=1;case 1:return t.trys.push([1,4,,5]),[4,(0,n.fetchApi)(e)];case 2:return[4,t.sent().text()];case 3:return s=t.sent(),0===(o=this.parseNovelItems(s)).length&&console.log('No search results found for term: "'.concat(r,'" on page ').concat(a)),[2,o];case 4:return i=t.sent(),console.error("Error searching novels:",i),[2,[]];case 5:return[2]}}))}))},o.prototype.parseNovel=function(s){return e(this,void 0,void 0,(function(){var e,o,i,c,u,l,h,p,d,f,v,m,g,b,y,w,x,N,C,S;return t(this,(function(t){switch(t.label){case 0:e=this.site+s,t.label=1;case 1:return t.trys.push([1,9,,10]),[4,(0,n.fetchApi)(e)];case 2:return[4,t.sent().text()];case 3:o=t.sent(),i=(0,r.load)(o),c={name:"",path:s,cover:a.defaultCover,author:"",artist:"",genres:"",summary:"",status:"",chapters:[]},u=i(".manga-title").first(),c.name=u.text().trim()||"Unknown Title",l=i("div.summary_image img").first(),h=l.attr("data-src")||l.attr("src"),c.cover=h||a.defaultCover,p=i("div.genres-content a"),d=[],p.each((function(e,t){var r=i(t).text().trim();r&&d.push(r)})),c.genres=d.join(","),f=i("div.manga-excerpt p"),v=[],f.each((function(e,t){var r=i(t).text().trim();r&&v.push(r)})),c.summary=v.join("\n\n"),m=i("div.manga-status span:nth-child(2)").first(),g=m.text().trim(),c.status=this.parseNovelStatus(g),b=[],t.label=4;case 4:return t.trys.push([4,7,,8]),y="".concat(e,"/ajax/chapters/?t=1"),[4,(0,n.fetchApi)(y,{method:"POST"})];case 5:return[4,t.sent().text()];case 6:return w=t.sent(),x=(0,r.load)(w),(N=x("li.free-chap")).each((function(e,t){var r=x(t),n=r.find("a").first(),a=n.text().trim(),s=n.attr("href"),o=r.find("span.chapter-release-date").first().text().trim()||null,i=N.length-e,c=a.match(/Ch\s*(\d+(?:\.\d+)?)/i);if(c||(c=a.match(/c(\d+(?:\.\d+)?)/i)),c&&(i=parseFloat(c[1])),a&&s){var u=void 0;if(s.startsWith("http"))u=new URL(s).pathname.replace(/^\/+|\/+$/g,"");else u=s.replace(/^\/+|\/+$/g,"");b.push({name:a,path:u,releaseTime:o,chapterNumber:i})}})),b.reverse(),[3,8];case 7:return C=t.sent(),console.error("Error fetching chapter list:",C),b=[],[3,8];case 8:return c.chapters=b,[2,c];case 9:return S=t.sent(),console.error("Error parsing novel:",S),[2,{name:"Error loading novel",path:s,cover:a.defaultCover,chapters:[]}];case 10:return[2]}}))}))},o.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var e,s,o,i,c,u;return t(this,(function(t){switch(t.label){case 0:e=this.site+a,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,(0,n.fetchApi)(e)];case 2:return[4,t.sent().text()];case 3:return s=t.sent(),o=(0,r.load)(s),0===(i=o("div.reading-content").first()).length?(console.warn("Chapter content container not found"),[2,""]):(i.find('input[type="hidden"]').remove(),i.find("img").each((function(e,t){var r=o(t),n=r.attr("data-src");n&&!r.attr("src")&&r.attr("src",n),r.attr("alt")||r.attr("alt","Chapter image")})),i.find("p, div, br").each((function(e,t){var r,n,a=o(t);"p"===(null===(r=t.tagName)||void 0===r?void 0:r.toLowerCase())&&a.text().trim(),"div"===(null===(n=t.tagName)||void 0===n?void 0:n.toLowerCase())&&a.text().trim()})),(c=i.html())&&(c=c.replace(/<!--[\s\S]*?-->/g,"")),[2,(null==c?void 0:c.trim())||""]);case 4:return u=t.sent(),console.error("Error parsing chapter:",u),[2,""];case 5:return[2]}}))}))},o}();exports.default=new o;