var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),n=require("cheerio"),i=function(){function i(){this.id="agit.xyz",this.name="Agitoon",this.icon="src/kr/agitoon/icon.png",this.site="https://agit664.xyz",this.version="3.1.0"}return i.prototype.checkUrl=function(){return t(this,void 0,void 0,(function(){var t;return e(this,(function(e){switch(e.label){case 0:return i.url?[3,2]:[4,(0,r.fetchApi)(this.site)];case 1:(t=e.sent()).ok?i.url=t.url.replace(/\/$/,""):i.url=this.site,e.label=2;case 2:return[2]}}))}))},i.prototype.popularNovels=function(n,o){return t(this,arguments,void 0,(function(t,n){var o,s,a,c,u=n.showLatestNovels;return e(this,(function(e){switch(e.label){case 0:return[4,this.checkUrl()];case 1:return e.sent(),[4,(0,r.fetchApi)(i.url+"/novel/index.update.php",{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",body:new URLSearchParams({mode:"get_data_novel_list_p",novel_menu:u?"1":"3",np_day:(new Date).getDay(),np_rank:"1",np_distributor:"0",np_genre:"00",np_order:"1",np_genre_ex_1:"00",np_genre_ex_2:"00",list_limit:20*(t-1),is_query_first:1==t}).toString()})];case 2:if(!(o=e.sent()).ok)throw new Error("Failed to get popular novels: (".concat(o.status,": ").concat(o.statusText,") (try to open in webview)"));return[4,o.json()];case 3:return s=e.sent(),a=[],null===(c=null==s?void 0:s.list)||void 0===c||c.forEach((function(t){return a.push({name:t.wr_subject,cover:i.url+t.np_dir+"/thumbnail/"+t.np_thumbnail,path:t.wr_id})})),[2,a]}}))}))},i.prototype.parseNovel=function(o){return t(this,void 0,void 0,(function(){var t,s,a,c,u,l,h;return e(this,(function(e){switch(e.label){case 0:return[4,this.checkUrl()];case 1:return e.sent(),[4,(0,r.fetchApi)(this.resolveUrl(o,!0)).then((function(t){return t.text()}))];case 2:return t=e.sent(),s=(0,n.load)(t,{decodeEntities:!1}),(a={path:o,name:s("h5.pt-2").text(),cover:s("div.col-5.pr-0.pl-0 img").attr("src"),summary:s(".pt-1.mt-1.pb-1.mb-1").text()}).author=s(".post-item-list-cate-v").first().text().split(" : ")[1],(c=s(".col-7 > .post-item-list-cate > span").map((function(t,e){return s(e).text().trim()})).get()).length&&(a.genres=c.join(", ")),u=[],[4,(0,r.fetchApi)(i.url+"/novel/list.update.php",{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",body:new URLSearchParams({mode:"get_data_novel_list_c",wr_id_p:o,page_no:"1",cnt_list:"10000",order_type:"Asc"}).toString()})];case 3:return[4,e.sent().json()];case 4:return l=e.sent(),null===(h=null==l?void 0:l.list)||void 0===h||h.forEach((function(t){return u.push({name:t.wr_subject,path:t.wr_id+"/2",releaseTime:t.wr_datetime})})),a.chapters=u,[2,a]}}))}))},i.prototype.parseChapter=function(i){return t(this,void 0,void 0,(function(){var t,o;return e(this,(function(e){switch(e.label){case 0:return[4,this.checkUrl()];case 1:return e.sent(),[4,(0,r.fetchApi)(this.resolveUrl(i)).then((function(t){return t.text()}))];case 2:return t=e.sent(),o=(0,n.load)(t),[2,(o("#id_wr_content").html()||"").replace("팝업메뉴는 빈공간을 더치하거나 스크룰시 사라집니다","").trim()]}}))}))},i.prototype.searchNovels=function(n,o){return t(this,void 0,void 0,(function(){var t,s,a;return e(this,(function(e){switch(e.label){case 0:return 1!==o?[2,[]]:[4,this.checkUrl()];case 1:return e.sent(),[4,(0,r.fetchApi)(i.url+"/novel/search.php",{headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",body:new URLSearchParams({mode:"get_data_novel_list_p_sch",search_novel:n,list_limit:0}).toString()})];case 2:return[4,e.sent().json()];case 3:return t=e.sent(),s=[],null===(a=null==t?void 0:t.list)||void 0===a||a.forEach((function(t){return s.push({name:t.wr_subject,cover:i.url+"/"+t.np_dir+"/thumbnail/"+t.np_thumbnail,path:t.wr_id})})),[2,s]}}))}))},i.prototype.resolveUrl=function(t,e){return i.url||(0,r.fetchApi)(this.site).then((function(t){return i.url=t.url.replace(/\/$/,"")})),(i.url?i.url:this.site)+(e?"/novel/list/":"/novel/view/")+t},i}();exports.default=new i;